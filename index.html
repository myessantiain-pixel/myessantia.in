<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>MyEssantia | best · premium essentials</title>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Premium Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  
  <!-- Common CSS -->
  <link rel="stylesheet" href="common.css">
  <link rel="stylesheet" href="header.css">
  <link rel="stylesheet" href="footer.css">
  
  <style>
    /* ---------- HOME PAGE SPECIFIC STYLES ---------- */
    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Enhanced hover effects */
    .hover-scale {
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .hover-scale:hover {
      transform: scale(1.02);
    }

    .hover-lift {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .hover-lift:hover {
      transform: translateY(-8px);
      box-shadow: 0 25px 40px -15px rgba(0,0,0,0.2);
    }

    .hover-glow {
      transition: box-shadow 0.3s ease;
    }
    .hover-glow:hover {
      box-shadow: 0 0 25px rgba(212, 175, 55, 0.3);
    }

    /* Add/update these styles in your CSS */
.image-frame {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 1rem;
  background-color: #f4f2ef;
  transition: transform 0.3s ease;
}

.primary-img, .secondary-img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.primary-img {
  opacity: 1;
  z-index: 2;
}

.secondary-img {
  opacity: 0;
  z-index: 1;
}

/* Hover effect handled by JavaScript but we keep this as fallback */
.product-card:hover .primary-img {
  opacity: 0;
}

.product-card:hover .secondary-img {
  opacity: 1;
}

.product-card:hover .image-frame {
  transform: scale(1.02);
}

/* Image actions stay visible */
.image-actions {
  position: absolute;
  bottom: 10px;
  left: 0;
  width: 100%;
  display: flex;
  gap: 8px;
  justify-content: center;
  padding: 0 8px;
  z-index: 10;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.product-card:hover .image-actions {
  opacity: 1;
  transform: translateY(0);
}

    .hero-buttons .btn {
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
  overflow: hidden;
  z-index: 1;
  transform: translateY(0) scale(1);
  box-shadow: none;
  border-color: #d4af37;
}

.hero-buttons .btn:not(:hover) {
  transform: translateY(0) scale(1);
  box-shadow: none;
  border-color: #d4af37;
}

.hero-buttons .btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 10px 25px -5px rgba(212, 175, 55, 0.5);
  border-color: #d4af37;
}

.hero-buttons .btn:active {
  transform: translateY(-1px) scale(1.02);
  transition: all 0.1s ease;
}

.hero-buttons .btn-outline {
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  background: transparent;
  color: #1a1714;
  border-color: #1a1714;
}

.hero-buttons .btn-outline:not(:hover) {
  background: transparent;
  color: #1a1714;
  border-color: #1a1714;
  transform: translateY(0) scale(1);
  box-shadow: none;
}

.hero-buttons .btn-outline:hover {
  background: #d4af37;
  color: #0c0c0c;
  border-color: #d4af37;
  transform: translateY(-3px);
  box-shadow: 0 10px 25px -5px rgba(212, 175, 55, 0.4);
}

.hero-buttons .btn-outline:active {
  transform: translateY(-1px) scale(1.02);
  transition: all 0.1s ease;
}

    /* Active navigation styling */
    .nav-link.active {
      color: #d4af37 !important;
      font-weight: 600;
      position: relative;
    }
    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: #d4af37;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from { width: 0; opacity: 0; }
      to { width: 100%; opacity: 1; }
    }

    /* HERO SECTION */
    .hero {
      background: #f8f6f2;
      min-height: auto;
      padding: 3rem 0;
      position: relative;
      overflow: hidden;
    }

    .hero-bg {
      position: absolute;
      inset: 0;
      background-image: url('https://images.unsplash.com/photo-1601924994987-69e26d50dc26?q=80&w=2070&auto=format&fit=crop');
      background-size: cover;
      background-position: 60% 40%;
      opacity: 0.2;
      transition: transform 8s ease;
    }
    .hero:hover .hero-bg {
      transform: scale(1.1);
    }

    .hero .container { 
      position: relative; 
      z-index: 2;
      display: flex;
      justify-content: flex-start;
    }

    .hero-content {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(12px);
      padding: 2rem 1.8rem;
      border-radius: 40px;
      box-shadow: 0 30px 50px -30px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.6);
      max-width: 700px;
      width: fit-content;
      margin-left: 0;
      margin-right: auto;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .hero-content:hover {
      transform: translateY(-10px) scale(1.01);
      box-shadow: 0 40px 60px -30px rgba(212, 175, 55, 0.3);
      border-color: rgba(212, 175, 55, 0.3);
    }

    .hero-sub {
      font-size: 0.7rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #6f6b63;
      margin-bottom: 1rem;
      transition: letter-spacing 0.3s ease;
    }
    .hero-content:hover .hero-sub {
      letter-spacing: 4px;
      color: #d4af37;
    }

    .hero-title {
      font-size: 2.6rem;
      font-weight: 400;
      line-height: 1.1;
      color: #1a1714;
      margin-bottom: 1.2rem;
    }

    .hero-title strong {
      font-weight: 600;
      color: #d4af37;
      font-style: italic;
      transition: all 0.3s ease;
      display: inline-block;
    }
    .hero-title strong:hover {
      transform: scale(1.05) rotate(-1deg);
      text-shadow: 2px 2px 10px rgba(212, 175, 55, 0.3);
    }

    .hero-desc {
      font-size: 1rem;
      color: #3e3a35;
      margin-bottom: 2rem;
    }

    .hero-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      align-items: center;
    }

    /* VALUE STRIP */
    .value-strip {
      background: #ffffff;
      padding: 1.2rem 0;
      border-bottom: 1px solid #eeeeee;
      position: relative;
      overflow: hidden;
    }
    .value-strip::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #d4af37, transparent);
      animation: shimmer 3s infinite;
    }
    @keyframes shimmer {
      100% { left: 100%; }
    }

    .value-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.2rem 1.8rem;
    }

    .value-item {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.9rem;
      color: #2b2b2b;
      font-weight: 300;
      transition: all 0.3s ease;
      padding: 0.3rem 0.8rem;
      border-radius: 30px;
    }
    .value-item:hover {
      background: rgba(212, 175, 55, 0.1);
      transform: translateY(-2px);
      color: #d4af37;
    }
    .value-item:hover i {
      transform: scale(1.2) rotate(5deg);
    }

    .value-item i { 
      color: #d4af37; 
      width: 1.2rem; 
      text-align: center;
      transition: transform 0.3s ease;
    }

    /* SECTION HEADER */
    .section-header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
      margin: 2rem 0 1.5rem;
      position: relative;
    }

    .section-title {
      font-size: 2.2rem;
      font-weight: 400;
      letter-spacing: -0.02em;
      transition: transform 0.3s ease;
    }
    .section-title:hover {
      transform: translateX(10px);
    }

    .section-title span {
      font-weight: 600;
      color: #d4af37;
      border-bottom: 2px solid #ece8e2;
      padding-bottom: 0.2rem;
      transition: all 0.3s ease;
    }
    .section-title span:hover {
      border-bottom-color: #d4af37;
      letter-spacing: 0.5px;
    }

    .view-all-link {
      text-decoration: none;
      color: #1a1a1a;
      font-weight: 400;
      font-size: 1rem;
      border-bottom: 1px solid #d4af37;
      padding-bottom: 3px;
      align-self: flex-start;
      transition: all 0.3s ease;
    }
    .view-all-link:hover {
      transform: translateX(5px);
      color: #d4af37;
      border-bottom-width: 2px;
    }
    .view-all-link:hover i {
      transform: translateX(5px);
    }
    .view-all-link i {
      transition: transform 0.3s ease;
    }

    /* PRODUCT GRID */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.2rem;
      margin: 1rem 0 3rem;
    }

    .product-card {
      background: #fff;
      border-radius: 24px;
      padding: 0.8rem 0.6rem 1.2rem;
      box-shadow: 0 8px 22px -8px rgba(0,0,0,0.05);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-align: center;
      border: 1px solid #f5f5f5;
      display: flex;
      flex-direction: column;
      height: 100%;
      text-decoration: none;
      color: inherit;
      cursor: pointer;
      animation: fadeInUp 0.6s ease backwards;
      position: relative;
      overflow: hidden;
    }
    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
      z-index: 5;
      pointer-events: none;
    }
    .product-card:hover::before {
      left: 100%;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .product-card:hover {
      box-shadow: 0 30px 40px -20px rgba(212, 175, 55, 0.3);
      border-color: #d4af37;
      transform: translateY(-10px) scale(1.02);
    }

    .image-frame {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 1rem;
      background-color: #f4f2ef;
    }

    .primary-img, .secondary-img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .primary-img { opacity: 1; z-index: 2; }
    .secondary-img { opacity: 0; z-index: 1; }
    .image-frame:hover .primary-img { opacity: 0; }
    .image-frame:hover .secondary-img { opacity: 1; }

    .image-actions {
      position: absolute;
      bottom: 10px;
      left: 0;
      width: 100%;
      display: flex;
      gap: 8px;
      justify-content: center;
      padding: 0 8px;
      z-index: 10;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .image-frame:hover .image-actions {
      opacity: 1;
      transform: translateY(0);
    }

    .img-add, .img-buy {
      flex: 1;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(4px);
      border: none;
      border-radius: 30px;
      padding: 0.6rem 0.2rem;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
      border: 1px solid rgba(0,0,0,0.1);
      color: #1a1a1a;
      font-family: 'Plus Jakarta Sans', sans-serif;
      pointer-events: auto;
      transition: all 0.3s ease;
    }

    .img-add:hover {
      background: #ffffff;
      border-color: #d4af37;
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
    }

    .img-buy {
      background: rgba(212,175,55,0.9);
      color: #0c0c0c;
      border-color: #d4af37;
    }
    .img-buy:hover {
      background: #d4af37;
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
    }

    .product-category {
      font-size: 0.7rem;
      color: #a2a2a2;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin: 0.2rem 0;
    }

    .product-rating {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 3px;
      flex-wrap: wrap;
      margin: 0.2rem 0;
    }

    .product-rating i { 
      color: #d4af37; 
      font-size: 0.8rem;
      transition: all 0.2s ease;
    }
    .product-card:hover .product-rating i {
      transform: scale(1.2);
    }
    .product-rating span { margin-left: 2px; color: #5f5b57; font-size: 0.7rem; }

    .product-price {
      color: #d4af37;
      font-weight: 600;
      font-size: 1.4rem;
      margin: 0.2rem 0 0;
      font-family: 'Montserrat', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
    }

    .product-price .inr-symbol { font-size: 1.2rem; font-weight: 500; }

    .stock-badge {
      font-size: 0.8rem;
      margin-top: 0.3rem;
      padding: 0.2rem 0.5rem;
      border-radius: 20px;
      display: inline-block;
      align-self: center;
      transition: all 0.3s ease;
    }
    .in-stock { color: #4CAF50; }
    .low-stock { color: #FF9800; }
    .out-of-stock { color: #f44336; }

    /* FEATURED COLLECTION */
    .featured-collection {
      background: #f8f5f1;
      border-radius: 40px;
      padding: 2rem 2rem 2.5rem;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      margin: 2rem 0;
      transition: all 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    .featured-collection::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(212,175,55,0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }
    .featured-collection:hover::after {
      opacity: 1;
    }
    .featured-collection:hover {
      transform: scale(1.02);
      box-shadow: 0 30px 50px -20px rgba(0,0,0,0.2);
    }

    .featured-text h2 { font-size: 2.2rem; }
    .gold { color: #d4af37; }

    .featured-image {
      width: 100%;
      aspect-ratio: 16/9;
      background-image: url('https://images.unsplash.com/photo-1620799140408-edc6dcb6d633?q=80&w=1972&auto=format&fit=crop');
      background-size: cover;
      border-radius: 30px;
      transition: all 0.5s ease;
    }
    .featured-collection:hover .featured-image {
      transform: scale(1.05) rotate(1deg);
    }

    .featured-text .btn {
      transition: all 0.3s ease;
      display: inline-block;
    }
    .featured-text .btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4);
    }

    /* TESTIMONIALS */
    .testimonials {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.2rem;
      margin: 2rem 0 3rem;
    }

    .testimonial {
      background: #ffffff;
      padding: 1.8rem 1.5rem;
      border-radius: 28px;
      border: 1px solid #f2eee9;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      animation: fadeInUp 0.6s ease backwards;
      animation-delay: calc(var(--order) * 0.1s);
    }
    .testimonial:hover {
      transform: translateY(-10px) scale(1.02);
      border-color: #d4af37;
      box-shadow: 0 20px 30px -10px rgba(212, 175, 55, 0.2);
    }
    .testimonial i {
      color: #d4af37;
      transition: transform 0.3s ease;
    }
    .testimonial:hover i {
      transform: scale(1.2) rotate(10deg);
    }

    /* Scroll to top button */
    .scroll-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #d4af37;
      color: #0c0c0c;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      z-index: 100;
    }
    .scroll-top.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .scroll-top:hover {
      transform: translateY(-5px) scale(1.1);
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
    }

    /* RESPONSIVE BREAKPOINTS */
    @media (min-width: 640px) {
      .hero-title { font-size: 3.2rem; }
      .hero-content { padding: 2.5rem; }
      .product-grid { grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
      .testimonials { grid-template-columns: repeat(2, 1fr); }
    }

    @media (min-width: 900px) {
      .product-grid { grid-template-columns: repeat(4, 1fr); }
      .featured-collection { flex-direction: row; align-items: center; padding: 3rem; }
      .featured-image { flex: 1; aspect-ratio: auto; height: 320px; }
      .featured-text { flex: 1; }
    }

    @media (min-width: 1100px) {
      .hero-title { font-size: 3.8rem; }
      .section-header { flex-direction: row; justify-content: space-between; align-items: center; }
      .testimonials { grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>
<body class="bg-noise">
  
  <!-- Header loaded dynamically -->
  <div id="header"></div>

  <!-- Scroll to top button -->
  <button class="scroll-top" id="scrollTop" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
    <i class="fa-solid fa-arrow-up"></i>
  </button>

  <main>
    <!-- HERO SECTION -->
    <section class="hero">
      <div class="hero-bg"></div>
      <div class="container">
        <div class="hero-content">
          <div class="hero-sub">best · premium essentials</div>
          <h1 class="hero-title">curated <strong>accessories</strong> <br>shipped worldwide</h1>
          <p class="hero-desc">Partner with vetted suppliers. Daily essentials, minimalist design, and fast fulfillment.</p>
          <div class="hero-buttons">
            <a href="#" class="btn" id="startShoppingBtn">start shopping</a>
            <a href="collection.html" class="btn btn-outline">view all</a>
          </div>
        </div>
      </div>
    </section>

    <!-- VALUE STRIP -->
    <div class="value-strip">
      <div class="container">
        <div class="value-grid">
          <div class="value-item"><i class="fa-solid fa-bolt"></i> <span>fast dispatch · 2–5 days</span></div>
          <div class="value-item"><i class="fa-regular fa-handshake"></i> <span>vetted suppliers IN/Asia</span></div>
          <div class="value-item"><i class="fa-regular fa-credit-card"></i> <span>secure payment</span></div>
          <div class="value-item"><i class="fa-regular fa-comment-dots"></i> <span>24/7 support</span></div>
        </div>
      </div>
    </div>

    <!-- PRODUCTS SECTION -->
    <div class="container" id="products-section">
      <div class="section-header">
        <h2 class="section-title"><span>accessories & essentials</span> — new arrivals</h2>
        <a href="accessories.html" class="view-all-link">view all products <i class="fa-solid fa-arrow-right"></i></a>
      </div>

      <div class="product-grid" id="product-grid-container">
        <!-- Products will be loaded dynamically -->
      </div>
    </div>

    <!-- FEATURED COLLECTION -->
    <div class="container">
      <div class="featured-collection">
        <div class="featured-text">
          <h2><span class="gold">premium supplier</span> <br>tech & travel kit</h2>
          <p style="margin: 1.5rem 0; color: #4f4a44;">Curated from Germany & Korea — power banks, multi-chargers, and organizers tested for quality.</p>
          <a href="essentials.html" class="btn" style="background: #d4af37; border-color: #d4af37; color: #0c0c0c;">explore tech essentials</a>
        </div>
        <div class="featured-image"></div>
      </div>
    </div>

    <!-- TESTIMONIALS -->
    <div class="container">
      <h2 class="section-title"><span>why <span class="italic-gold">people</span></span> trust us </h2>
      <div class="testimonials">
        <div class="testimonial" style="--order: 1">
          <i class="fa-solid fa-quote-left"></i>
          <p>“Reliable <span class="italic-gold">suppliers</span> & fast shipping. The quality exceeds expectations.”</p>
          <h5>— roy, kottayam</h5>
        </div>
        <div class="testimonial" style="--order: 2">
          <i class="fa-solid fa-quote-left"></i>
          <p>“I use MyEssantia for my accessory niche. best & premium products.”</p>
          <h5>— maria, kochi</h5>
        </div>
        <div class="testimonial" style="--order: 3">
          <i class="fa-solid fa-quote-left"></i>
          <p>“The accessories collection is a bestseller. good & consistent quality.”</p>
          <h5>— sofia, idukki</h5>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer loaded dynamically -->
  <div id="footer"></div>

  <!-- Common Modals -->
  <div id="common-modals"></div>

  <!-- Common JavaScript -->
  <script src="common.js"></script>

<script>
// ========== HOME PAGE SPECIFIC FUNCTIONS ==========
let scrollTimeout;
let products = []; // Global products array

function renderProducts() {
  const gridContainer = document.getElementById('product-grid-container');
  if (!gridContainer) return;

  // Use the global products array from common.js (loaded from Firebase)
  const homeProducts = products.filter(p => p.showOnHome === true);

  if (homeProducts.length === 0) {
    gridContainer.innerHTML = `
      <div style="grid-column: 1/-1; text-align: center; padding: 4rem; color: #999;">
        <i class="fa-solid fa-box-open" style="font-size: 4rem; margin-bottom: 1rem;"></i>
        <h3>No products on homepage</h3>
        <p>Check back later for new arrivals!</p>
      </div>
    `;
    return;
  }

  let gridHtml = '';
  homeProducts.forEach((product, index) => {
    const mainImage = product.images && product.images[0] ? product.images[0] : (product.primaryImg || 'https://via.placeholder.com/300');
    const secondImage = product.images && product.images[1] ? product.images[1] : (product.secondaryImg || mainImage);
    
    gridHtml += `
      <a href="product.html?id=${product.id}" class="product-card" data-product-id="${product.id}" style="animation-delay: ${index * 0.1}s">
        <div class="image-frame">
          <div class="primary-img" style="background-image: url('${mainImage}');"></div>
          <div class="secondary-img" style="background-image: url('${secondImage}');"></div>
          <div class="image-actions" onclick="event.preventDefault(); event.stopPropagation();">
            <button class="img-add" onclick="window.addToCart('${product.id}'); event.preventDefault(); event.stopPropagation();">
              <i class="fa-solid fa-cart-plus"></i> add
            </button>
            <button class="img-buy" onclick="window.buyNow('${product.id}'); event.preventDefault(); event.stopPropagation();">
              <i class="fa-solid fa-bolt"></i> buy
            </button>
          </div>
        </div>
        <h3 class="product-title">${product.title}</h3>
        <p class="product-category">${product.category}</p>
        <div class="product-rating">${renderRating(product.rating)}</div>
        <div class="product-price">
          <span class="inr-symbol">₹</span>${formatPrice(product.price)}
        </div>
        ${getStockStatus(product.stock)}
      </a>
    `;
  });
  
  gridContainer.innerHTML = gridHtml;
}

function renderRating(rating) {
  if (!rating) return '<span>No ratings</span>';
  const fullStars = Math.floor(rating);
  const halfStar = rating % 1 >= 0.5;
  const emptyStars = 5 - Math.ceil(rating);
  
  let stars = '';
  for (let i = 0; i < fullStars; i++) stars += '<i class="fa-solid fa-star"></i>';
  if (halfStar) stars += '<i class="fa-solid fa-star-half-alt"></i>';
  for (let i = 0; i < emptyStars; i++) stars += '<i class="fa-regular fa-star"></i>';
  
  return stars + `<span>(${rating.toFixed(1)})</span>`;
}

function formatPrice(price) {
  return price ? price.toLocaleString('en-IN') : '0';
}

function getStockStatus(stock) {
  if (stock > 10) return '<div class="stock-badge in-stock"><i class="fa-solid fa-check-circle"></i> In Stock</div>';
  if (stock > 0) return '<div class="stock-badge low-stock"><i class="fa-solid fa-exclamation-circle"></i> Low Stock</div>';
  return '<div class="stock-badge out-of-stock"><i class="fa-solid fa-times-circle"></i> Out of Stock</div>';
}

// Scroll to products function
function scrollToProducts() {
  const productsSection = document.getElementById('products-section');
  if (productsSection) {
    productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

// Set active navigation
function setActiveNav() {
  // Set Home as active
  const homeLinks = document.querySelectorAll('.nav-link[href="index.html"]');
  homeLinks.forEach(link => {
    link.classList.add('active');
  });
  
  // Remove active from others
  const otherLinks = document.querySelectorAll('.nav-link:not([href="index.html"])');
  otherLinks.forEach(link => {
    link.classList.remove('active');
  });
}

// Scroll to top button visibility and button reset
function handleScroll() {
  const scrollTop = document.getElementById('scrollTop');
  if (scrollTop) {
    if (window.scrollY > 300) {
      scrollTop.classList.add('visible');
    } else {
      scrollTop.classList.remove('visible');
    }
  }
  
  // Reset button states after scrolling
  clearTimeout(scrollTimeout);
  
  // Add scrolling class to prevent animation sticking
  const buttons = document.querySelectorAll('.hero-buttons .btn, .view-all-link');
  buttons.forEach(button => {
    button.classList.add('scrolling');
    
    // Force remove any hover styles
    button.style.transform = '';
    button.style.boxShadow = '';
    button.style.backgroundColor = '';
    button.style.color = '';
  });
  
  scrollTimeout = setTimeout(() => {
    buttons.forEach(button => {
      button.classList.remove('scrolling');
      // Force a reflow to ensure normal state
      void button.offsetHeight;
    });
  }, 100);
}

// Parallax effect on scroll
function handleParallax() {
  const heroBg = document.querySelector('.hero-bg');
  if (heroBg) {
    const scrolled = window.scrollY;
    heroBg.style.transform = `scale(1.1) translateY(${scrolled * 0.1}px)`;
  }
}

// Add ripple effect to button
function createRipple(event, button) {
  const ripple = document.createElement('span');
  ripple.classList.add('ripple');
  
  const rect = button.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  
  ripple.style.width = ripple.style.height = `${size}px`;
  ripple.style.left = `${event.clientX - rect.left - size/2}px`;
  ripple.style.top = `${event.clientY - rect.top - size/2}px`;
  
  button.appendChild(ripple);
  
  setTimeout(() => {
    ripple.remove();
  }, 600);
}

// Update cart count (to be implemented based on your cart system)
function updateCartCount() {
  // Implement your cart count logic here
  console.log('Cart count updated');
}

// Load common components (header, footer)
async function loadComponents() {
  try {
    // Load header
    const headerResponse = await fetch('header.html');
    const headerData = await headerResponse.text();
    document.getElementById('header').innerHTML = headerData;
    
    // Load footer
    const footerResponse = await fetch('footer.html');
    const footerData = await footerResponse.text();
    document.getElementById('footer').innerHTML = footerData;
    
    // Set active nav after components are loaded
    setTimeout(setActiveNav, 100);
  } catch (error) {
    console.error('Error loading components:', error);
  }
}

// Load common modals
async function loadCommonModals() {
  try {
    const response = await fetch('common.html');
    const data = await response.text();
    document.getElementById('common-modals').innerHTML = data;
  } catch (error) {
    console.error('Error loading common modals:', error);
  }
}

// Initialize everything
function initializeApp() {
  // Products are already loaded from Firebase in common.js
  renderProducts();
  updateCartCount();
  
  // Set active navigation
  setActiveNav();
  
  // Add click handler for start shopping button with ripple effect
  const startShoppingBtn = document.getElementById('startShoppingBtn');
  if (startShoppingBtn) {
    // Remove any existing listeners
    const newStartShoppingBtn = startShoppingBtn.cloneNode(true);
    startShoppingBtn.parentNode.replaceChild(newStartShoppingBtn, startShoppingBtn);
    
    newStartShoppingBtn.addEventListener('click', (e) => {
      e.preventDefault();
      
      // Add ripple effect
      createRipple(e, newStartShoppingBtn);
      
      // Ensure button returns to normal after click
      newStartShoppingBtn.style.transform = 'translateY(-1px) scale(1.02)';
      
      setTimeout(() => {
        newStartShoppingBtn.style.transform = '';
        newStartShoppingBtn.style.boxShadow = '';
        scrollToProducts();
      }, 150);
      
      setTimeout(() => {
        newStartShoppingBtn.style.transition = '';
      }, 300);
    });
  }
  
  // Add hover effect handlers for view all link
  const viewAllLink = document.querySelector('.view-all-link');
  if (viewAllLink) {
    viewAllLink.addEventListener('mouseenter', () => {
      if (!viewAllLink.classList.contains('scrolling')) {
        viewAllLink.style.transform = 'translateX(8px)';
        viewAllLink.style.color = '#d4af37';
      }
    });
    
    viewAllLink.addEventListener('mouseleave', () => {
      viewAllLink.style.transform = '';
      viewAllLink.style.color = '';
    });
  }
  
  // Add scroll event listeners
  window.addEventListener('scroll', handleScroll, { passive: true });
  window.addEventListener('scroll', handleParallax, { passive: true });
  
  // Animate value items on scroll
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
      }
    });
  }, { threshold: 0.1, rootMargin: '50px' });

  document.querySelectorAll('.value-item').forEach(item => {
    item.style.opacity = '0';
    item.style.transform = 'translateY(20px)';
    item.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
    observer.observe(item);
  });
  
  // Add transition end handler for all buttons
  const buttons = document.querySelectorAll('.hero-buttons .btn, .view-all-link');
  buttons.forEach(button => {
    button.addEventListener('transitionend', () => {
      if (!button.matches(':hover') && !button.classList.contains('scrolling')) {
        button.style.transform = '';
        button.style.boxShadow = '';
        button.style.backgroundColor = '';
        button.style.color = '';
      }
    });
    
    // Ensure button resets on mouse leave
    button.addEventListener('mouseleave', () => {
      if (!button.classList.contains('scrolling')) {
        button.style.transform = '';
        button.style.boxShadow = '';
        button.style.backgroundColor = '';
        button.style.color = '';
      }
    });
  });
  
  // Add scroll to top button click handler
  const scrollTopBtn = document.getElementById('scrollTop');
  if (scrollTopBtn) {
    scrollTopBtn.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
  }
}

// Document ready handler
document.addEventListener('DOMContentLoaded', () => {
  loadCommonModals();
  loadComponents();
  
  // Initialize after a short delay to ensure components are loaded
  setTimeout(initializeApp, 500);
});

// Window load handler for fallback
window.addEventListener('load', () => {
  // If products array is empty but we have cached products, use them as fallback
  if (products.length === 0) {
    const cachedProducts = localStorage.getItem('MyEssantia_products');
    if (cachedProducts) {
      try {
        products = JSON.parse(cachedProducts);
        renderProducts();
      } catch (e) {
        console.error('Error parsing cached products:', e);
      }
    }
  }
  
  // Re-initialize to ensure everything is set up
  setTimeout(() => {
    setActiveNav();
    initializeApp();
  }, 200);
});

// Clean up event listeners on page unload
window.addEventListener('beforeunload', () => {
  window.removeEventListener('scroll', handleScroll);
  window.removeEventListener('scroll', handleParallax);
});

// Export functions for global use
window.addToCart = function(productId) {
  console.log('Add to cart:', productId);
  // Implement your add to cart logic here
};

window.buyNow = function(productId) {
  console.log('Buy now:', productId);
  // Implement your buy now logic here
};

window.scrollToProducts = scrollToProducts;
  </script>
</body>
</html>
