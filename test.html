<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>ESSENCE · essentials (responsive)</title>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Premium Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&family=Plus+Jakarta+Sans:wght@200;300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  
  <!-- Common CSS -->
  <link rel="stylesheet" href="common.css">
  <link rel="stylesheet" href="header.css">
  <link rel="stylesheet" href="footer.css">
  
  <style>
    /* -------------------- ESSENTIALS PAGE SPECIFIC STYLES -------------------- */
    .page-title {
      text-align: center;
      padding: clamp(1.5rem, 4vw, 2rem) 0 clamp(0.5rem, 2vw, 1rem);
    }
    .page-title h1 {
      font-size: clamp(2.2rem, 6vw, 3.2rem);
      font-weight: 400;
      color: #1a1a1a;
      line-height: 1.2;
    }
    .page-title h1 span {
      color: #d4af37;
      font-weight: 500;
      font-style: italic;
    }
    .page-title p {
      color: #5f5b57;
      max-width: 600px;
      margin: 1rem auto 0;
      font-size: clamp(0.95rem, 2.5vw, 1.1rem);
      padding: 0 1rem;
    }

    /* SORT BAR */
    .sort-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 1.5rem 0 1rem;
      border-bottom: 1px solid #f0f0f0;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .sort-select {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: #fafafa;
      padding: 0.5rem 1.2rem;
      border-radius: 40px;
      border: 1px solid #eaeaea;
      cursor: pointer;
      transition: 0.2s;
      width: fit-content;
    }
    .sort-select:hover {
      border-color: #d4af37;
    }
    .sort-select i {
      color: #d4af37;
      font-size: 1rem;
    }
    .sort-select select {
      background: transparent;
      border: none;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 0.9rem;
      font-weight: 400;
      color: #1a1a1a;
      outline: none;
      cursor: pointer;
    }

    /* PRODUCT GRID */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: clamp(1rem, 2.5vw, 2rem);
      margin: 2rem 0 4rem;
    }

    .product-card {
      background: #fff;
      border-radius: 28px;
      padding: 1.2rem 1rem 1.8rem;
      box-shadow: 0 8px 22px -8px rgba(0,0,0,0.05);
      transition: all 0.25s ease;
      text-align: center;
      border: 1px solid #f5f5f5;
      display: flex;
      flex-direction: column;
      height: 100%;
      text-decoration: none;
      color: inherit;
      cursor: pointer;
    }
    .product-card:hover {
      box-shadow: 0 20px 30px -12px rgba(0,0,0,0.15);
      border-color: #e0d9d0;
      transform: translateY(-6px);
    }

    .image-frame {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 24px;
      overflow: hidden;
      margin-bottom: 1.5rem;
      background-color: #f4f2ef;
    }

    .primary-img, .secondary-img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      transition: opacity 0.35s ease;
    }

    .primary-img {
      opacity: 1;
      z-index: 2;
    }
    .secondary-img {
      opacity: 0;
      z-index: 1;
    }
    .image-frame:hover .primary-img {
      opacity: 0;
    }
    .image-frame:hover .secondary-img {
      opacity: 1;
    }

    .image-actions {
      position: absolute;
      bottom: 16px;
      left: 0;
      width: 100%;
      display: flex;
      gap: 10px;
      justify-content: center;
      padding: 0 12px;
      z-index: 10;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .image-frame:hover .image-actions {
      opacity: 1;
      transform: translateY(0);
    }

    .img-add, .img-buy {
      flex: 1;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(4px);
      border: none;
      border-radius: 40px;
      padding: 0.7rem 0.2rem;
      font-size: 0.8rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid rgba(0,0,0,0.1);
      color: #1a1a1a;
      font-family: 'Plus Jakarta Sans', sans-serif;
      pointer-events: auto;
    }
    .img-add i, .img-buy i {
      font-size: 0.85rem;
    }
    .img-add:hover {
      background: #ffffff;
      border-color: #d4af37;
      transform: scale(1.03);
    }
    .img-buy {
      background: rgba(212,175,55,0.9);
      color: #0c0c0c;
      border-color: #d4af37;
    }
    .img-buy:hover {
      background: #d4af37;
      transform: scale(1.03);
      box-shadow: 0 4px 10px rgba(212,175,55,0.3);
    }

    .product-title {
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      font-size: clamp(1.1rem, 2vw, 1.3rem);
      margin-bottom: 0.3rem;
      color: #1e1e1e;
      letter-spacing: -0.01em;
    }

    .product-category {
      font-size: 0.75rem;
      color: #a2a2a2;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.4rem;
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-weight: 300;
    }

    .product-rating {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      margin: 0.3rem 0 0.3rem;
      flex-wrap: wrap;
    }
    .product-rating i {
      color: #d4af37;
      font-size: 0.9rem;
    }
    .product-rating span {
      margin-left: 4px;
      color: #5f5b57;
      font-size: 0.8rem;
      font-weight: 300;
    }

    .product-price {
      color: #d4af37;
      font-weight: 600;
      font-size: clamp(1.4rem, 3vw, 1.6rem);
      margin: 0.4rem 0 0.2rem;
      font-family: 'Montserrat', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2px;
    }
    .product-price .inr-symbol {
      font-size: clamp(1.2rem, 2.5vw, 1.4rem);
      font-weight: 500;
      margin-right: 2px;
    }

    .stock-badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      display: inline-block;
      align-self: center;
      margin-top: 0.5rem;
      font-weight: 500;
    }
    .in-stock {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .low-stock {
      background: #fff3e0;
      color: #ef6c00;
    }
    .out-of-stock {
      background: #ffebee;
      color: #c62828;
    }

    /* PAGINATION */
    .pagination {
      display: flex;
      justify-content: center;
      gap: clamp(0.5rem, 2vw, 1rem);
      margin: 3rem 0 4rem;
      flex-wrap: wrap;
    }
    .pagination a {
      text-decoration: none;
      color: #1a1a1a;
      padding: 0.5rem 1rem;
      border-radius: 30px;
      border: 1px solid #e0e0e0;
      transition: 0.2s;
      font-weight: 400;
      min-width: 40px;
      text-align: center;
    }
    .pagination a:hover, .pagination a.active-page {
      background: #d4af37;
      border-color: #d4af37;
      color: #0c0c0c;
    }

    /* Enquiry Form Styles (specific to essentials page) */
    .enquiry-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* RESPONSIVE BREAKPOINTS */
    @media (min-width: 1200px) {
      .container {
        padding: 0 3rem;
      }
      .page-title h1 {
        font-size: 3.2rem;
      }
    }

    @media (max-width: 992px) {
      .product-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
      }
    }

    @media (max-width: 768px) {
      .product-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.2rem;
      }
      .container {
        padding: 0 1.5rem;
      }
      .page-title h1 {
        font-size: clamp(2rem, 7vw, 2.8rem);
      }
      .sort-bar {
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .product-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      .container {
        padding: 0 1rem;
      }
      .sort-bar {
        justify-content: stretch;
      }
      .sort-select {
        width: 100%;
        justify-content: center;
      }
      .sort-select select {
        flex: 1;
      }
      .product-card {
        padding: 1rem 0.8rem 1.5rem;
      }
      .pagination a {
        padding: 0.6rem 1rem;
        min-width: 44px;
      }
    }

    @media (max-width: 360px) {
      .image-actions {
        flex-direction: column;
        gap: 6px;
        bottom: 10px;
      }
      .img-add, .img-buy {
        padding: 0.5rem;
        font-size: 0.75rem;
      }
    }

    img {
      max-width: 100%;
      height: auto;
      display: block;
    }
  </style>
</head>
<body class="bg-noise">
  
  <!-- Header loaded dynamically -->
  <div id="header"></div>

  <main>
    <!-- page title -->
    <div class="container page-title">
      <h1>all <span>essentials</span></h1>
      <p>Everyday necessities — tech, travel & self-care, curated for modern life.</p>
    </div>

    <!-- sort bar -->
    <div class="container">
      <div class="sort-bar">
        <div class="sort-select">
          <i class="fa-solid fa-arrow-down-wide-short"></i>
          <select id="sort-select" aria-label="Sort products">
            <option value="popular">sort by: popular</option>
            <option value="price-low">price: low to high</option>
            <option value="price-high">price: high to low</option>
            <option value="rating">top rated</option>
          </select>
        </div>
      </div>
    </div>

    <!-- product grid container -->
    <div class="container">
      <div id="product-grid-container" class="product-grid">
        <!-- products injected via JS -->
      </div>

      <!-- pagination container -->
      <div id="pagination-container" class="pagination"></div>
    </div>
  </main>

  <!-- Footer loaded dynamically -->
  <div id="footer"></div>

  <!-- Common Modals -->
  <div id="common-modals"></div>

  <!-- Enquiry Form Modal (specific to essentials page) -->
  <div id="enquiry-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Submit Enquiry</h3>
        <button class="close-modal" id="close-enquiry">&times;</button>
      </div>
      <div id="enquiry-content">
        <!-- Enquiry form will be rendered here -->
      </div>
    </div>
  </div>

  <!-- Common JavaScript -->
  <script src="common.js"></script>

  <script>
    // ========== ESSENTIALS PAGE SPECIFIC VARIABLES ==========
    let enquiries = JSON.parse(localStorage.getItem('essence_user_enquiries')) || [];

    // Update products with essentials-specific flags
    if (products.length > 0) {
      // Add showOnEssentials flag to existing products
      products = products.map(p => {
        if (p.id === 101 || p.id === 102 || p.id === 103 || p.id === 104 || 
            p.id === 105 || p.id === 106 || p.id === 107 || p.id === 108) {
          return { ...p, showOnEssentials: true };
        }
        return p;
      });
      localStorage.setItem('MyEssantia_products', JSON.stringify(products));
    }

    // ========== PRODUCT RENDERING ==========
    function renderProducts() {
      const gridContainer = document.getElementById('product-grid-container');
      const sortSelect = document.getElementById('sort-select');
      
      if (!gridContainer) return;

      const essentialsProducts = products.filter(p => 
        p.showOnEssentials === true && p.category === 'essentials'
      );

      if (essentialsProducts.length === 0) {
        gridContainer.innerHTML = `
          <div style="grid-column: 1/-1; text-align: center; padding: 4rem; color: #999;">
            <i class="fa-solid fa-box-open" style="font-size: 4rem; margin-bottom: 1rem;"></i>
            <h3>No essential products found</h3>
            <p>Check back later for new arrivals!</p>
          </div>
        `;
        return;
      }

      function getSortedProducts() {
        let sorted = [...essentialsProducts];
        switch (sortSelect.value) {
          case 'price-low':
            sorted.sort((a, b) => a.price - b.price);
            break;
          case 'price-high':
            sorted.sort((a, b) => b.price - a.price);
            break;
          case 'rating':
            sorted.sort((a, b) => b.rating - a.rating);
            break;
          default:
            break;
        }
        return sorted;
      }

      function renderAllProducts() {
        const sortedProducts = getSortedProducts();
        
        let gridHtml = '';
        sortedProducts.forEach(product => {
          const mainImage = product.images && product.images[0] ? product.images[0] : (product.primaryImg || 'https://via.placeholder.com/300');
          const secondImage = product.images && product.images[1] ? product.images[1] : (product.secondaryImg || mainImage);
          
          gridHtml += `
            <a href="product.html?id=${product.id}" class="product-card" data-product-id="${product.id}">
              <div class="image-frame">
                <div class="primary-img" style="background-image: url('${mainImage}');"></div>
                <div class="secondary-img" style="background-image: url('${secondImage}');"></div>
                <div class="image-actions" onclick="event.preventDefault(); event.stopPropagation();">
                  <button class="img-add" onclick="window.addToCart(${product.id}); event.preventDefault(); event.stopPropagation();">
                    <i class="fa-solid fa-cart-plus"></i> add
                  </button>
                  <button class="img-buy" onclick="window.buyNow(${product.id}); event.preventDefault(); event.stopPropagation();">
                    <i class="fa-solid fa-bolt"></i> buy
                  </button>
                </div>
              </div>
              <h3 class="product-title">${product.title}</h3>
              <p class="product-category">${product.category}</p>
              <div class="product-rating">${renderRating(product.rating)}</div>
              <div class="product-price">
                <span class="inr-symbol">₹</span>${formatPrice(product.price)}
              </div>
              ${getStockStatus(product.stock)}
            </a>
          `;
        });
        
        gridContainer.innerHTML = gridHtml;
      }

      renderAllProducts();
      
      if (sortSelect) {
        sortSelect.removeEventListener('change', renderAllProducts);
        sortSelect.addEventListener('change', renderAllProducts);
      }
    }

    // ========== INITIALIZATION ==========
    function initializeApp() {
      renderProducts();
      updateCartCount();
      initializeEnquiry();
      
      const savedUser = localStorage.getItem('MyEssantia_user');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateProfileIcon();
      }
    }

    // Override setupEventListeners to include enquiry modal
    function setupEventListeners() {
      // Call the original setupEventListeners from common.js
      if (typeof window.originalSetupEventListeners === 'function') {
        window.originalSetupEventListeners();
      }

      const closeEnquiry = document.getElementById('close-enquiry');
      if (closeEnquiry) {
        closeEnquiry.addEventListener('click', function() {
          closeModal('enquiry-modal');
        });
      }

      // Add enquiry button listener
      const enquiryBtn = document.getElementById('enquiry-btn');
      if (enquiryBtn) {
        enquiryBtn.addEventListener('click', function(e) {
          e.preventDefault();
          if (!currentUser) {
            alert('Please login to submit an enquiry');
            openProfile();
          } else {
            openEnquiry();
          }
        });
      }

      // Update window click listener
      const originalClickHandler = window.onclick;
      window.addEventListener('click', function(e) {
        const enquiryModal = document.getElementById('enquiry-modal');
        if (e.target === enquiryModal) {
          closeModal('enquiry-modal');
        }
      });

      // Update escape key handler
      const originalKeyHandler = document.onkeydown;
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeModal('enquiry-modal');
        }
      });
    }

    // Store original setupEventListeners
    window.originalSetupEventListeners = setupEventListeners;

    // ========== ENQUIRY FUNCTIONS ==========
    function initializeEnquiry() {
      loadEnquiries();
    }

    function loadEnquiries() {
      const stored = localStorage.getItem('essence_user_enquiries');
      if (stored) {
        try {
          enquiries = JSON.parse(stored);
        } catch (e) {
          enquiries = [];
        }
      } else {
        enquiries = [];
      }
    }

    function saveEnquiries() {
      localStorage.setItem('essence_user_enquiries', JSON.stringify(enquiries));
    }

    function openEnquiry() {
      const enquiryModal = document.getElementById('enquiry-modal');
      if (enquiryModal) {
        renderEnquiryForm();
        enquiryModal.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
    }

    function renderEnquiryForm() {
      const enquiryContent = document.getElementById('enquiry-content');
      if (!enquiryContent) return;

      enquiryContent.innerHTML = `
        <div class="enquiry-form">
          <div class="form-group">
            <label for="enquiry-subject">Subject</label>
            <input type="text" id="enquiry-subject" placeholder="What is your enquiry about?">
          </div>
          <div class="form-group">
            <label for="enquiry-message">Message</label>
            <textarea id="enquiry-message" rows="5" placeholder="Please describe your enquiry in detail..."></textarea>
          </div>
          <div class="form-group">
            <label for="enquiry-priority">Priority</label>
            <select id="enquiry-priority">
              <option value="normal">Normal</option>
              <option value="urgent">Urgent</option>
              <option value="low">Low</option>
            </select>
          </div>
          <button class="btn" onclick="window.submitEnquiry()" style="width: 100%; margin-top: 1rem;">
            <i class="fa-regular fa-paper-plane"></i> Submit Enquiry
          </button>
          <div id="enquiry-message-status" class="auth-message"></div>
        </div>
      `;
    }

    window.submitEnquiry = function() {
      const subject = document.getElementById('enquiry-subject')?.value;
      const message = document.getElementById('enquiry-message')?.value;
      const priority = document.getElementById('enquiry-priority')?.value;
      const statusDiv = document.getElementById('enquiry-message-status');

      if (!subject || !message) {
        if (statusDiv) {
          statusDiv.className = 'auth-error';
          statusDiv.textContent = 'Please fill in all fields';
        }
        return;
      }

      const newEnquiry = {
        id: 'ENQ' + Date.now() + Math.floor(Math.random() * 1000),
        userId: currentUser?.uid || 'guest',
        userName: currentUser?.name || 'Guest User',
        userEmail: currentUser?.email || 'guest@example.com',
        subject: subject,
        message: message,
        priority: priority,
        status: 'pending',
        timestamp: Date.now(),
        date: new Date().toISOString()
      };

      enquiries.push(newEnquiry);
      saveEnquiries();

      if (statusDiv) {
        statusDiv.className = 'auth-success';
        statusDiv.textContent = 'Enquiry submitted successfully! We will respond within 24 hours.';
      }

      document.getElementById('enquiry-subject').value = '';
      document.getElementById('enquiry-message').value = '';

      setTimeout(() => {
        closeModal('enquiry-modal');
      }, 2000);
    };

    // Load common modals
    async function loadCommonModals() {
      try {
        const response = await fetch('common.html');
        const data = await response.text();
        document.getElementById('common-modals').innerHTML = data;
      } catch (error) {
        console.error('Error loading common modals:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadCommonModals();
      loadComponents();
    });
  </script>

  <style>
    /* Enquiry Form specific styles */
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-group select {
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Plus Jakarta Sans', sans-serif;
      transition: all 0.3s;
    }

    .form-group select:focus {
      outline: none;
      border-color: #d4af37;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    }
  </style>
</body>
</html>
