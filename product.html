<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>Product Â· MyEssantia</title>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Premium Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  
  <style>
    /* ========== MODERN DESIGN SYSTEM WITH 2D BORDERS ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Premium Color Palette */
      --primary: #c7a23b;
      --primary-dark: #a07d2b;
      --primary-light: #f3e9d2;
      --primary-soft: #faf3e0;
      
      --accent-black: #1e1e1e;
      --accent-charcoal: #2c2c2c;
      
      --bg-warm: #fcf9f4;
      --bg-soft: #ffffff;
      --bg-card: #ffffff;
      
      --text-primary: #2c2c2c;
      --text-secondary: #5c5c5c;
      --text-tertiary: #8e8e8e;
      
      --border-light: #e8e2d4;
      --border-medium: #d4cdbc;
      --border-accent: #c7a23b;
      
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 16px 32px rgba(0, 0, 0, 0.08);
      --shadow-gold: 0 8px 24px rgba(199, 162, 59, 0.12);
      
      /* 2D Border Variables - Can be adjusted per element */
      --border-2d-offset: 4px;
      --border-2d-blur: 0px;
      --border-2d-color: rgba(0, 0, 0, 0.1);
      --border-2d-highlight: rgba(255, 255, 255, 0.8);
      
      --spacing-xs: 0.5rem;
      --spacing-sm: 0.75rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-xxl: 3rem;
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 18px;
      --radius-xl: 24px;
      --radius-full: 999px;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--bg-warm);
      color: var(--text-primary);
      line-height: 1.5;
      font-weight: 400;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    /* ========== 2D BORDER EFFECT CLASSES ========== */
    .border-2d {
      position: relative;
      border: 1px solid var(--border-medium);
      transition: all 0.2s ease;
    }
    
    .border-2d::after {
      content: '';
      position: absolute;
      top: var(--border-2d-offset);
      left: var(--border-2d-offset);
      right: calc(-1 * var(--border-2d-offset));
      bottom: calc(-1 * var(--border-2d-offset));
      background: transparent;
      border: 1px solid var(--border-2d-color);
      filter: blur(var(--border-2d-blur));
      z-index: -1;
      pointer-events: none;
      transition: all 0.2s ease;
    }
    
    .border-2d:hover {
      transform: translate(calc(-1 * var(--border-2d-offset) / 2), calc(-1 * var(--border-2d-offset) / 2));
    }
    
    .border-2d:hover::after {
      top: calc(var(--border-2d-offset) * 1.5);
      left: calc(var(--border-2d-offset) * 1.5);
    }
    
    /* Different offset intensities */
    .border-2d-sm { --border-2d-offset: 2px; }
    .border-2d-md { --border-2d-offset: 4px; }
    .border-2d-lg { --border-2d-offset: 6px; }
    .border-2d-xl { --border-2d-offset: 8px; }
    
    /* Different blur intensities */
    .border-2d-blur-none { --border-2d-blur: 0px; }
    .border-2d-blur-sm { --border-2d-blur: 1px; }
    .border-2d-blur-md { --border-2d-blur: 2px; }
    .border-2d-blur-lg { --border-2d-blur: 3px; }
    
    /* Different colors */
    .border-2d-gold { --border-2d-color: rgba(199, 162, 59, 0.3); }
    .border-2d-dark { --border-2d-color: rgba(0, 0, 0, 0.15); }
    .border-2d-light { --border-2d-color: rgba(255, 255, 255, 0.5); }

    /* ========== BREADCRUMB ========== */
    .breadcrumb {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      padding: 2rem 0 1.5rem;
      color: var(--text-tertiary);
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .breadcrumb a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: color 0.2s;
    }

    .breadcrumb a:hover {
      color: var(--primary);
    }

    .breadcrumb i {
      font-size: 0.7rem;
      color: var(--border-medium);
    }

    /* ========== MAIN GRID ========== */
    .product-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      padding: 1rem 0 4rem;
    }

    /* ========== GALLERY ========== */
    .gallery-section {
      position: sticky;
      top: 2rem;
      height: fit-content;
    }

    .main-image {
      width: 100%;
      aspect-ratio: 1;
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-bottom: 1.25rem;
      background: var(--bg-warm);
      cursor: zoom-in;
    }

    .main-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.6s ease;
    }

    .main-image:hover img {
      transform: scale(1.02);
    }

    .thumbnail-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
    }

    .thumbnail {
      aspect-ratio: 1;
      border-radius: var(--radius-md);
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      opacity: 0.7;
      transition: all 0.2s;
      background: var(--bg-warm);
    }

    .thumbnail:hover,
    .thumbnail.active {
      border-color: var(--primary);
      opacity: 1;
      transform: translateY(-2px);
      box-shadow: var(--shadow-gold);
    }

    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========== PRODUCT INFO ========== */
    .product-info {
      padding: 1rem 0;
      position: relative;
    }

    .product-category {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--primary);
      letter-spacing: 1.5px;
      margin-bottom: 0.5rem;
    }

    .product-title {
      font-family: 'Playfair Display', serif;
      font-size: 3.2rem;
      font-weight: 600;
      line-height: 1.1;
      color: var(--text-primary);
      margin-bottom: 1rem;
      letter-spacing: -0.5px;
      padding-right: 4rem;
    }

    /* ========== SOCIAL PROOF SECTIONS ========== */
    .sold-badge {
      display: inline-block;
      background: linear-gradient(135deg, #d32f2f, #b71c1c);
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: var(--radius-full);
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(183, 28, 28, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .live-viewers {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      background: linear-gradient(135deg, #2e7d32, #1b5e20);
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: var(--radius-full);
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 12px rgba(27, 94, 32, 0.3);
      animation: pulse 2s infinite;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.9; box-shadow: 0 4px 20px rgba(46, 125, 50, 0.5); }
      100% { opacity: 1; }
    }

    .live-viewers i {
      font-size: 0.7rem;
      color: #4caf50;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.3; }
      100% { opacity: 1; }
    }

    .product-meta {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
      padding: 1rem 0;
      border-top: 1px solid var(--border-light);
      border-bottom: 1px solid var(--border-light);
      flex-wrap: wrap;
    }

    .product-brand {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .product-brand i {
      color: var(--primary);
    }

    .rating-reviews {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .stars {
      color: var(--primary);
      display: flex;
      gap: 3px;
      font-size: 0.95rem;
    }

    .rating-value {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.9rem;
    }

    .reviews-count {
      color: var(--text-tertiary);
      font-size: 0.85rem;
      font-weight: 500;
    }

    /* ========== SHARE BUTTON ========== */
    .share-container {
      position: absolute;
      top: 1.5rem;
      right: 0;
      z-index: 50;
    }

    .share-main-btn {
      background: var(--bg-soft);
      border: 1px solid var(--border-medium);
      padding: 0.7rem 1.5rem;
      border-radius: var(--radius-full);
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .share-main-btn i {
      color: var(--primary);
      font-size: 1rem;
    }

    .share-main-btn:hover {
      border-color: var(--primary);
      background: var(--bg-soft);
      transform: translateY(-2px);
      box-shadow: var(--shadow-gold);
    }

    .share-menu {
      position: absolute;
      top: calc(100% + 1rem);
      right: 0;
      background: var(--bg-soft);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      width: 340px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }

    .share-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .share-menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-light);
    }

    .share-menu-header span {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .share-menu-header button {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: var(--text-tertiary);
      transition: color 0.2s;
    }

    .share-menu-header button:hover {
      color: var(--primary);
    }

    .share-options {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .share-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 0.5rem;
      border: 1px solid var(--border-light);
      background: var(--bg-soft);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .share-option i {
      font-size: 1.3rem;
    }

    .share-option:hover {
      border-color: var(--primary);
      background: var(--primary-light);
      transform: translateY(-2px);
    }

    .share-link-container {
      background: var(--bg-warm);
      padding: 1rem;
      border-radius: var(--radius-md);
    }

    .share-link-box {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .share-link-box input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      background: var(--bg-soft);
      color: var(--text-primary);
    }

    .copy-link-btn {
      padding: 0.75rem 1.25rem;
      background: var(--primary);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .copy-link-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-gold);
    }

    /* ========== PRICE SECTION WITH PREPAID/COD ========== */
    .price-section {
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--bg-soft) 100%);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
    }

    .price-row {
      display: flex;
      align-items: baseline;
      gap: 1.25rem;
      flex-wrap: wrap;
    }

    .current-price {
      font-size: 3.2rem;
      font-weight: 800;
      color: var(--accent-black);
      font-family: 'Montserrat', sans-serif;
      line-height: 1;
    }

    .inr-symbol {
      font-size: 2.2rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .original-price {
      font-size: 1.4rem;
      font-weight: 500;
      color: var(--text-tertiary);
      text-decoration: line-through;
    }

    .discount-badge {
      background: var(--accent-black);
      color: white;
      padding: 0.4rem 1.2rem;
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 700;
    }

    /* Prepaid & COD Pricing */
    .pricing-options {
      display: flex;
      gap: 1rem;
      margin: 1.5rem 0 0.5rem;
    }

    .price-option {
      flex: 1;
      padding: 1rem;
      border-radius: var(--radius-md);
      background: var(--bg-soft);
      text-align: center;
      transition: all 0.2s;
    }

    .price-option.prepaid {
      border: 2px solid var(--primary);
      background: var(--primary-light);
    }

    .price-option.cod {
      border: 2px solid var(--border-medium);
    }

    .price-option-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.3rem;
    }

    .price-option-value {
      font-size: 1.6rem;
      font-weight: 800;
      color: var(--accent-black);
    }

    .price-option-save {
      font-size: 0.75rem;
      color: #d32f2f;
      font-weight: 600;
      margin-top: 0.2rem;
    }

    .stock-status {
      display: inline-block;
      padding: 0.5rem 1.5rem;
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 600;
      margin-top: 1rem;
      border: 1px solid transparent;
    }

    .in-stock {
      background: #e8f3e8;
      color: #2e7d32;
      border-color: #a5d6a7;
    }

    .low-stock {
      background: #fff8e1;
      color: #b76e00;
      border-color: #ffe082;
    }

    .high-demand-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: #fff0ed;
      color: #d84315;
      padding: 0.5rem 1.2rem;
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 700;
      margin-left: 1rem;
      border: 1px solid #ffb199;
    }

    /* ========== RAZORPAY MONEY BACK PROMISE ========== */
    .moneyback-promise {
      background: linear-gradient(135deg, #1e3a5f, #0a1e3a);
      color: white;
      padding: 1.5rem;
      border-radius: var(--radius-lg);
      margin: 1.5rem 0;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .moneyback-promise::before {
      content: 'âœ“âœ“';
      position: absolute;
      right: -20px;
      bottom: -20px;
      font-size: 8rem;
      opacity: 0.1;
      color: var(--primary);
      transform: rotate(-15deg);
    }

    .promise-icon {
      font-size: 2.5rem;
      color: var(--primary);
      background: rgba(255, 255, 255, 0.1);
      width: 70px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .promise-text h4 {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.3rem;
    }

    .promise-text p {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .promise-highlight {
      color: var(--primary);
      font-weight: 700;
    }

    /* ========== DELIVERY CARD ========== */
    .delivery-card {
      background: var(--bg-soft);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .delivery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .delivery-title {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text-primary);
    }

    .delivery-title i {
      color: var(--primary);
      font-size: 1.4rem;
    }

    .delivery-threshold {
      background: var(--primary-light);
      color: var(--primary-dark);
      padding: 0.5rem 1.5rem;
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      font-weight: 700;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: var(--border-light);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      width: 0%;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: var(--radius-full);
    }

    .delivery-message {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-weight: 600;
      font-size: 0.95rem;
      padding: 0.5rem 0;
    }

    .delivery-message.eligible i {
      color: #2e7d32;
    }

    .delivery-message.not-eligible i {
      color: var(--primary);
    }

    .cart-value {
      font-weight: 800;
      background: var(--primary-light);
      color: var(--primary-dark);
      padding: 0.2rem 0.8rem;
      border-radius: var(--radius-full);
    }

    /* ========== PRODUCT HIGHLIGHTS ========== */
    .product-highlights {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .highlight-card {
      background: var(--bg-soft);
      padding: 1.25rem;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: all 0.2s;
    }

    .highlight-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-gold);
    }

    .highlight-icon {
      width: 48px;
      height: 48px;
      background: var(--primary-light);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 1.3rem;
    }

    .highlight-text h4 {
      font-weight: 700;
      font-size: 0.95rem;
      margin-bottom: 0.2rem;
      color: var(--text-primary);
    }

    .highlight-text p {
      font-size: 0.8rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* ========== QUANTITY SELECTOR ========== */
    .quantity-section {
      margin: 1.5rem 0;
      background: var(--bg-soft);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
    }

    .quantity-label {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1.25rem;
      font-size: 1rem;
    }

    .quantity-label i {
      color: var(--primary);
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .quantity-btn {
      width: 48px;
      height: 48px;
      border: 1px solid var(--border-medium);
      background: var(--bg-soft);
      border-radius: var(--radius-md);
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      font-weight: 600;
    }

    .quantity-btn:hover:not(:disabled) {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow-gold);
    }

    .quantity-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .quantity-input {
      width: 90px;
      height: 48px;
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      text-align: center;
      font-size: 1.2rem;
      font-weight: 700;
      background: var(--bg-soft);
      color: var(--text-primary);
    }

    .stock-info {
      margin-top: 1rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      color: var(--text-secondary);
      font-size: 0.85rem;
      font-weight: 500;
    }

    .stock-info i {
      color: var(--primary);
    }

    /* ========== ACTION BUTTONS ========== */
    .action-buttons {
      display: flex;
      gap: 1.25rem;
      margin: 1.5rem 0;
    }

    .btn {
      flex: 1;
      padding: 1.2rem;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
    }

    .btn-add-to-cart {
      background: var(--bg-soft);
      color: var(--text-primary);
      border: 2px solid var(--border-medium);
    }

    .btn-add-to-cart:hover:not(:disabled) {
      border-color: var(--primary);
      background: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: var(--shadow-gold);
    }

    .btn-buy-now {
      background: var(--accent-black);
      color: white;
    }

    .btn-buy-now:hover:not(:disabled) {
      background: var(--accent-charcoal);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* ========== REVIEWS SECTION ========== */
    .reviews-section {
      margin: 2rem 0;
      background: var(--bg-soft);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
    }

    .reviews-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .reviews-title {
      font-size: 1.3rem;
      font-weight: 700;
    }

    .reviews-title span {
      color: var(--primary);
    }

    .reviews-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .review-card {
      padding: 1rem;
      border-radius: var(--radius-md);
      background: var(--bg-warm);
      transition: all 0.2s;
    }

    .review-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .review-header {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin-bottom: 0.8rem;
    }

    .review-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-light);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--primary);
    }

    .review-info h5 {
      font-weight: 700;
      font-size: 0.9rem;
    }

    .review-time {
      font-size: 0.7rem;
      color: var(--text-tertiary);
    }

    .review-stars {
      color: var(--primary);
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }

    .review-text {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .review-footer {
      margin-top: 0.8rem;
      display: flex;
      gap: 1rem;
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    .review-footer i {
      margin-right: 0.3rem;
    }

    .view-all-reviews {
      text-align: center;
      padding: 1rem;
      background: var(--bg-warm);
      border-radius: var(--radius-md);
      font-weight: 600;
      color: var(--primary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .view-all-reviews:hover {
      background: var(--primary-light);
    }

    /* ========== PRODUCT DETAILS TABS ========== */
    .product-details-tabs {
      margin-top: 2rem;
      background: var(--bg-soft);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
    }

    .tab-headers {
      display: flex;
      gap: 2rem;
      border-bottom: 2px solid var(--border-light);
      overflow-x: auto;
    }

    .tab-header {
      padding: 1rem 0;
      cursor: pointer;
      font-weight: 600;
      color: var(--text-tertiary);
      position: relative;
      transition: color 0.2s;
      font-size: 0.95rem;
      white-space: nowrap;
    }

    .tab-header:hover {
      color: var(--primary);
    }

    .tab-header.active {
      color: var(--primary);
    }

    .tab-header.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--primary);
    }

    .tab-content {
      padding: 2rem 0 1rem;
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .specs-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .spec-item {
      padding: 1rem;
      background: var(--bg-warm);
      border-radius: var(--radius-md);
    }

    .spec-label {
      font-size: 0.8rem;
      color: var(--text-tertiary);
      margin-bottom: 0.3rem;
      font-weight: 500;
    }

    .spec-value {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 0.95rem;
    }

    /* Video Grid */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .video-thumb {
      aspect-ratio: 16/9;
      border-radius: var(--radius-md);
      overflow: hidden;
      position: relative;
      cursor: pointer;
    }

    .video-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-thumb i {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: white;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .video-thumb span {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.7rem;
    }

    /* ========== CART NOTIFICATION ========== */
    .cart-notification {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--bg-soft);
      color: var(--text-primary);
      padding: 1rem 2rem;
      border-radius: var(--radius-full);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      animation: slideInRight 0.3s ease;
      display: flex;
      align-items: center;
      gap: 1rem;
      font-weight: 600;
    }

    .cart-notification i {
      color: #22c55e;
      font-size: 1.2rem;
    }

    .cart-notification button {
      background: var(--primary);
      border: none;
      color: white;
      padding: 0.5rem 1.5rem;
      border-radius: var(--radius-full);
      font-weight: 600;
      cursor: pointer;
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 1024px) {
      .product-container { gap: 2.5rem; }
      .product-title { font-size: 2.8rem; }
      .reviews-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .container { padding: 0 1.5rem; }
      .product-container { grid-template-columns: 1fr; gap: 2rem; }
      .gallery-section { position: static; }
      .product-title { font-size: 2.4rem; }
      .share-main-btn span { display: none; }
      .reviews-grid { grid-template-columns: 1fr; }
      .video-grid { grid-template-columns: 1fr; }
      .action-buttons { flex-direction: column; }
      .pricing-options { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div id="header"></div>

  <main>
    <div class="container">
      <div class="breadcrumb">
        <a href="index.html">Home</a>
        <i class="fa-solid fa-chevron-right"></i>
        <a href="collection.html">Collection</a>
        <i class="fa-solid fa-chevron-right"></i>
        <span id="breadcrumb-product">Loading...</span>
      </div>
    </div>

    <div class="container" id="product-container"></div>
  </main>

  <div id="footer"></div>

  <script>
    // ========== FIREBASE CONFIG ==========
    const firebaseConfig = {
      apiKey: "AIzaSyD16uGnm1vodkbqGoFSdFdJjGFSLpJmflk",
      authDomain: "myessantia.firebaseapp.com",
      projectId: "myessantia",
      storageBucket: "myessantia.firebasestorage.app",
      messagingSenderId: "701726517205",
      appId: "1:701726517205:web:f6ab79efdffeab6dbbbf5c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ========== GLOBAL ==========
    let currentProduct = null;
    let cart = JSON.parse(localStorage.getItem('myessantia_cart')) || [];

    // Generate random values for social proof
    function getRandomSold() {
      return Math.floor(Math.random() * (1500 - 300 + 1)) + 300;
    }

    function getRandomViewers() {
      return Math.floor(Math.random() * (30 - 5 + 1)) + 5;
    }

    function getRandomReviews() {
      const names = ['Aarav Sharma', 'Ishita Patel', 'Rahul Verma', 'Priya Singh', 'Vikram Mehta', 'Ananya Gupta', 'Karthik Iyer', 'Neha Kapoor', 'Arjun Nair', 'Shreya Reddy'];
      const cities = ['Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Kolkata', 'Pune', 'Hyderabad', 'Ahmedabad'];
      const comments = [
        'Absolutely love this product! Quality is amazing.',
        'Perfect for daily use. Highly recommended!',
        'Great value for money. Fast delivery too.',
        'Exceeded my expectations. Will buy again.',
        'Good product but packaging could be better.',
        'Worth every penny! The design is beautiful.',
        'Exactly as described. Very happy with purchase.',
        'Fast shipping and great quality. 5 stars!',
        'My wife loved it. Thank you MyEssantia!',
        'Solid build quality. Works perfectly.'
      ];
      
      return { names, cities, comments };
    }

    // Sample reviews data
    function generateReviews(count = 6) {
      const { names, cities, comments } = getRandomReviews();
      const reviews = [];
      const now = Date.now();
      
      for (let i = 0; i < count; i++) {
        const randomName = names[Math.floor(Math.random() * names.length)];
        const randomCity = cities[Math.floor(Math.random() * cities.length)];
        const randomComment = comments[Math.floor(Math.random() * comments.length)];
        const randomRating = (Math.floor(Math.random() * 20) + 30) / 10; // 3.0 to 5.0
        const hoursAgo = Math.floor(Math.random() * 48) + 1;
        
        reviews.push({
          name: randomName,
          city: randomCity,
          comment: randomComment,
          rating: randomRating,
          time: hoursAgo,
          helpful: Math.floor(Math.random() * 25) + 5,
          avatar: randomName.charAt(0)
        });
      }
      
      return reviews.sort((a, b) => a.time - b.time);
    }

    function getProductId() {
      return new URLSearchParams(window.location.search).get('id');
    }

    // ========== LOAD PRODUCT ==========
    async function loadProduct() {
      const productId = getProductId();
      if (!productId) return showNotFound();

      try {
        const doc = await db.collection('products').doc(productId).get();
        if (!doc.exists) return showNotFound();

        currentProduct = { id: doc.id, ...doc.data() };
        document.getElementById('breadcrumb-product').textContent = currentProduct.title;
        renderProduct(currentProduct);
        loadRelated(currentProduct);
      } catch (error) {
        console.error(error);
        showNotFound();
      }
    }

    function showNotFound() {
      document.getElementById('product-container').innerHTML = `
        <div class="border-2d border-2d-lg border-2d-gold" style="text-align: center; padding: 4rem; background: white; border-radius: 24px;">
          <i class="fa-solid fa-box-open" style="font-size: 4rem; color: var(--text-tertiary);"></i>
          <h2 style="font-size: 2rem; margin: 1rem 0;">Product Not Found</h2>
          <p style="color: var(--text-secondary);">The product you're looking for doesn't exist.</p>
          <a href="collection.html" style="display: inline-block; margin-top: 2rem; padding: 1rem 2.5rem; background: var(--primary); color: white; text-decoration: none; border-radius: 40px; font-weight: 600;">Browse Collection</a>
        </div>
      `;
    }

    // ========== RENDER PRODUCT ==========
    function renderProduct(product) {
      const images = [];
      if (product.media?.images) images.push(...product.media.images.map(i => i.url));
      if (product.media?.videos) images.push(...product.media.videos.map(v => v.url));
      if (images.length === 0) images.push(product.primaryImg || 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=600');

      const stock = product.stock || 0;
      const originalPrice = Math.round(product.price * 1.2);
      const discount = Math.round(((originalPrice - product.price) / originalPrice) * 100);
      const prepaidPrice = Math.round(product.price * 0.95); // 5% discount for prepaid
      const codPrice = Math.round(product.price * 1.02); // 2% extra for COD
      
      const cartItem = cart.find(i => i.id === product.id);
      const quantity = cartItem ? cartItem.quantity : 1;

      // Generate random social proof values
      const soldCount = getRandomSold();
      const liveViewers = getRandomViewers();
      const reviews = generateReviews(6);

      const specs = Array.isArray(product.specs) ? product.specs : 
                   (product.specs ? product.specs.split('\n').filter(s => s.trim()) : 
                   ['Material: Premium', `Brand: ${product.brand || 'MyEssantia'}`, 'Origin: India']);

      const container = document.getElementById('product-container');
      container.innerHTML = `
        <div class="product-container">
          <!-- GALLERY -->
          <div class="gallery-section">
            <div class="main-image border-2d border-2d-lg border-2d-gold" style="border-radius: 18px; background: white; padding: 0; --border-2d-offset: 6px;" onclick="this.classList.toggle('zoomed')">
              <img src="${images[0]}" alt="${product.title}" id="mainImage" style="border-radius: 18px;">
            </div>
            <div class="thumbnail-grid">
              ${images.map((img, i) => `
                <div class="thumbnail ${i === 0 ? 'active' : ''} border-2d border-2d-sm" onclick="changeImage('${img}', this)" style="border-radius: 12px;">
                  <img src="${img}" alt="thumb">
                </div>
              `).join('')}
            </div>

            <!-- REVIEWS UNDER GALLERY -->
            <div class="reviews-section border-2d border-2d-md" style="margin-top: 2rem; --border-2d-offset: 4px;">
              <div class="reviews-header">
                <div class="reviews-title">
                  <span>â˜…</span> Real Reviews
                </div>
                <div style="font-weight: 600;">${product.rating?.toFixed(1) || '4.5'} Â· 128 reviews</div>
              </div>
              <div class="reviews-grid">
                ${reviews.slice(0, 3).map(r => `
                  <div class="review-card border-2d border-2d-sm" style="--border-2d-offset: 2px;">
                    <div class="review-header">
                      <div class="review-avatar">${r.avatar}</div>
                      <div class="review-info">
                        <h5>${r.name}</h5>
                        <div class="review-time">${r.city} Â· ${r.time}h ago</div>
                      </div>
                    </div>
                    <div class="review-stars">
                      ${'â˜…'.repeat(Math.floor(r.rating))}${r.rating % 1 ? 'Â½' : ''}
                    </div>
                    <div class="review-text">"${r.comment}"</div>
                    <div class="review-footer">
                      <span><i class="fa-regular fa-thumbs-up"></i> ${r.helpful}</span>
                      <span><i class="fa-regular fa-comment"></i> Reply</span>
                    </div>
                  </div>
                `).join('')}
              </div>
              <div class="view-all-reviews border-2d border-2d-sm">
                View all 128 reviews <i class="fa-solid fa-arrow-right"></i>
              </div>
            </div>
          </div>

          <!-- INFO -->
          <div class="product-info">
            <!-- SOCIAL PROOF BADGES -->
            <div class="sold-badge border-2d border-2d-sm border-2d-light" style="--border-2d-color: rgba(255,255,255,0.3);">
              <i class="fa-solid fa-fire"></i> ${soldCount}+ sold in last month
            </div>
            
            <div class="live-viewers border-2d border-2d-sm border-2d-light" style="--border-2d-color: rgba(255,255,255,0.3);">
              <i class="fa-solid fa-circle"></i> ${liveViewers} people are checking out right now
            </div>

            <div class="product-category">${product.category?.toUpperCase() || 'ACCESSORIES'}</div>
            <h1 class="product-title">${product.title}</h1>
            
            <!-- SHARE BUTTON -->
            <div class="share-container">
              <button class="share-main-btn border-2d border-2d-sm" onclick="toggleShare(event)">
                <i class="fa-solid fa-share-alt"></i>
                <span>SHARE</span>
              </button>
              <div class="share-menu border-2d border-2d-md" id="shareMenu" style="--border-2d-offset: 4px;">
                <div class="share-menu-header">
                  <span>Share this product</span>
                  <button onclick="closeShare()"><i class="fa-solid fa-times"></i></button>
                </div>
                <div class="share-options">
                  <button class="share-option border-2d border-2d-sm" onclick="share('facebook')"><i class="fa-brands fa-facebook-f"></i>FB</button>
                  <button class="share-option border-2d border-2d-sm" onclick="share('twitter')"><i class="fa-brands fa-x-twitter"></i>TW</button>
                  <button class="share-option border-2d border-2d-sm" onclick="share('whatsapp')"><i class="fa-brands fa-whatsapp"></i>WA</button>
                  <button class="share-option border-2d border-2d-sm" onclick="share('telegram')"><i class="fa-brands fa-telegram"></i>TG</button>
                  <button class="share-option border-2d border-2d-sm" onclick="share('email')"><i class="fa-regular fa-envelope"></i>MAIL</button>
                  <button class="share-option border-2d border-2d-sm" onclick="share('pinterest')"><i class="fa-brands fa-pinterest"></i>PIN</button>
                </div>
                <div class="share-link-container border-2d border-2d-sm">
                  <p class="share-link-label">Or copy link</p>
                  <div class="share-link-box">
                    <input type="text" id="shareLink" value="${window.location.href}" readonly>
                    <button class="copy-link-btn border-2d border-2d-sm" onclick="copyLink()" style="--border-2d-color: rgba(0,0,0,0.2);"><i class="fa-regular fa-copy"></i> COPY</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="product-meta">
              <span class="product-brand"><i class="fa-regular fa-building"></i> ${product.brand || 'MyEssantia'}</span>
              <div class="rating-reviews">
                <span class="stars">${getStars(product.rating)}</span>
                <span class="rating-value">${(product.rating || 0).toFixed(1)}</span>
                <span class="reviews-count">(128 reviews)</span>
              </div>
            </div>

            <!-- PRICE WITH PREPAID/COD OPTIONS -->
            <div class="price-section border-2d border-2d-md border-2d-gold" style="--border-2d-offset: 4px;">
              <div class="price-row">
                <span class="current-price"><span class="inr-symbol">â‚¹</span>${product.price.toFixed(2)}</span>
                <span class="original-price">â‚¹${originalPrice.toFixed(2)}</span>
                <span class="discount-badge">-${discount}%</span>
              </div>
              
              <div class="pricing-options">
                <div class="price-option prepaid border-2d border-2d-sm border-2d-gold">
                  <div class="price-option-label">PREPAID</div>
                  <div class="price-option-value">â‚¹${prepaidPrice}</div>
                  <div class="price-option-save">Save â‚¹${product.price - prepaidPrice}</div>
                </div>
                <div class="price-option cod border-2d border-2d-sm">
                  <div class="price-option-label">CASH ON DELIVERY</div>
                  <div class="price-option-value">â‚¹${codPrice}</div>
                  <div class="price-option-save">+â‚¹${codPrice - product.price} fee</div>
                </div>
              </div>
              
              <div style="display:flex; align-items:center; flex-wrap:wrap;">
                <span class="stock-status ${stock > 10 ? 'in-stock' : (stock > 0 ? 'low-stock' : 'out-of-stock')} border-2d border-2d-sm">
                  ${stock > 10 ? 'âœ“ IN STOCK' : (stock > 0 ? `âš  ONLY ${stock} LEFT` : 'âœ— OUT OF STOCK')}
                </span>
                ${product.highDemand ? '<span class="high-demand-badge border-2d border-2d-sm"><i class="fa-solid fa-fire"></i> HIGH DEMAND</span>' : ''}
              </div>
            </div>

            <!-- RAZORPAY MONEY BACK PROMISE -->
            <div class="moneyback-promise border-2d border-2d-lg border-2d-light" style="--border-2d-color: rgba(255,255,255,0.2); --border-2d-offset: 6px;">
              <div class="promise-icon">
                <i class="fa-solid fa-shield-halved"></i>
              </div>
              <div class="promise-text">
                <h4>Razorpay Money Back Promise</h4>
                <p><span class="promise-highlight">Get 100% refund</span> on non-delivery or defects</p>
              </div>
            </div>

            <!-- DELIVERY CARD -->
            <div class="delivery-card border-2d border-2d-md" id="deliveryCard" style="--border-2d-offset: 4px;">
              <div class="delivery-header">
                <span class="delivery-title"><i class="fa-solid fa-truck-fast"></i> FREE DELIVERY</span>
                <span class="delivery-threshold border-2d border-2d-sm">Min. â‚¹1,299</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="deliveryProgress" style="width: ${Math.min(100, (product.price * quantity / 1299) * 100)}%"></div>
              </div>
              <div class="delivery-message" id="deliveryMessage">
                <i class="fa-solid ${product.price * quantity >= 1299 ? 'fa-circle-check' : 'fa-circle-info'}"></i>
                <span id="deliveryText">
                  ${product.price * quantity >= 1299 
                    ? 'ðŸŽ‰ You get FREE delivery!' 
                    : `Add <span class="cart-value">â‚¹${(1299 - (product.price * quantity)).toFixed(2)}</span> more for free delivery`}
                </span>
              </div>
            </div>

            <!-- HIGHLIGHTS -->
            <div class="product-highlights">
              <div class="highlight-card border-2d border-2d-sm">
                <div class="highlight-icon"><i class="fa-solid fa-truck"></i></div>
                <div><h4>Free Shipping</h4><p>On orders above â‚¹1,299</p></div>
              </div>
              <div class="highlight-card border-2d border-2d-sm">
                <div class="highlight-icon"><i class="fa-solid fa-rotate-left"></i></div>
                <div><h4>Easy Returns</h4><p>48-hour window</p></div>
              </div>
            </div>

            <!-- QUANTITY -->
            <div class="quantity-section border-2d border-2d-md" style="--border-2d-offset: 4px;">
              <div class="quantity-label"><i class="fa-solid fa-cubes"></i> Select Quantity</div>
              <div class="quantity-controls">
                <button class="quantity-btn border-2d border-2d-sm" onclick="updateQuantity(-1)" ${stock === 0 ? 'disabled' : ''}>âˆ’</button>
                <input type="text" class="quantity-input" id="productQuantity" value="${quantity}" readonly>
                <button class="quantity-btn border-2d border-2d-sm" onclick="updateQuantity(1)" ${stock === 0 || quantity >= stock ? 'disabled' : ''}>+</button>
              </div>
              <div class="stock-info"><i class="fa-regular fa-clock"></i> ${stock} units available</div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="action-buttons">
              <button class="btn btn-add-to-cart border-2d border-2d-md" onclick="addToCart()" ${stock === 0 ? 'disabled' : ''}>
                <i class="fa-solid fa-cart-plus"></i> ADD TO CART
              </button>
              <button class="btn btn-buy-now border-2d border-2d-md border-2d-dark" onclick="buyNow()" ${stock === 0 ? 'disabled' : ''} style="--border-2d-color: rgba(255,255,255,0.3);">
                <i class="fa-solid fa-bolt"></i> BUY NOW
              </button>
            </div>

            <!-- PRODUCT DETAILS TABS WITH VIDEOS -->
            <div class="product-details-tabs border-2d border-2d-md" style="--border-2d-offset: 4px;">
              <div class="tab-headers">
                <div class="tab-header active" onclick="switchTab('desc')">Description</div>
                <div class="tab-header" onclick="switchTab('specs')">Specifications</div>
                <div class="tab-header" onclick="switchTab('videos')">Videos</div>
              </div>
              <div class="tab-content active" id="tab-desc">
                <p>${product.description || product.shortDesc || 'Premium quality product from MyEssantia.'}</p>
              </div>
              <div class="tab-content" id="tab-specs">
                <div class="specs-grid">
                  ${specs.map(s => {
                    const [k, v] = s.split(':');
                    return `<div class="spec-item border-2d border-2d-sm"><div class="spec-label">${k || 'Spec'}</div><div class="spec-value">${v || s}</div></div>`;
                  }).join('')}
                </div>
              </div>
              <div class="tab-content" id="tab-videos">
                <div class="video-grid">
                  ${product.media?.videos?.length > 0 ? product.media.videos.map((video, i) => `
                    <div class="video-thumb border-2d border-2d-md" onclick="window.open('${video.url}', '_blank')">
                      <img src="${video.thumbnail || 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400'}" alt="Video ${i+1}">
                      <i class="fa-solid fa-play"></i>
                      <span>${Math.floor(Math.random() * 3) + 1}:${Math.floor(Math.random() * 59)}</span>
                    </div>
                  `).join('') : `
                    <div class="video-thumb border-2d border-2d-md">
                      <img src="https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400" alt="Demo video">
                      <i class="fa-solid fa-play"></i>
                      <span>2:34</span>
                    </div>
                    <div class="video-thumb border-2d border-2d-md">
                      <img src="https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400" alt="Demo video">
                      <i class="fa-solid fa-play"></i>
                      <span>1:47</span>
                    </div>
                  `}
                </div>
              </div>
            </div>

            <!-- MORE REVIEWS BOTTOM -->
            <div class="reviews-section border-2d border-2d-md" style="margin-top: 2rem; --border-2d-offset: 4px;">
              <div class="reviews-header">
                <div class="reviews-title">
                  <span>â˜…</span> Recent Reviews
                </div>
                <div style="font-weight: 600;">${product.rating?.toFixed(1) || '4.5'} Â· 128 reviews</div>
              </div>
              <div class="reviews-grid">
                ${reviews.slice(3, 6).map(r => `
                  <div class="review-card border-2d border-2d-sm" style="--border-2d-offset: 2px;">
                    <div class="review-header">
                      <div class="review-avatar">${r.avatar}</div>
                      <div class="review-info">
                        <h5>${r.name}</h5>
                        <div class="review-time">${r.city} Â· ${r.time}h ago</div>
                      </div>
                    </div>
                    <div class="review-stars">
                      ${'â˜…'.repeat(Math.floor(r.rating))}${r.rating % 1 ? 'Â½' : ''}
                    </div>
                    <div class="review-text">"${r.comment}"</div>
                    <div class="review-footer">
                      <span><i class="fa-regular fa-thumbs-up"></i> ${r.helpful}</span>
                      <span><i class="fa-regular fa-comment"></i> Reply</span>
                    </div>
                  </div>
                `).join('')}
              </div>
              <div class="view-all-reviews border-2d border-2d-sm">
                View all 128 reviews <i class="fa-solid fa-arrow-right"></i>
              </div>
            </div>
          </div>
        </div>
      `;

      updateDeliveryBar(product.price * quantity);
    }

    // ========== LOAD RELATED PRODUCTS ==========
    async function loadRelated(product) {
      try {
        const snap = await db.collection('products')
          .where('category', '==', product.category)
          .limit(5)
          .get();
        
        const related = snap.docs
          .map(d => ({ id: d.id, ...d.data() }))
          .filter(p => p.id !== product.id)
          .slice(0, 4);

        if (related.length === 0) return;

        const html = `
          <div class="related-section">
            <h2 class="related-title">You May Also Like</h2>
            <div class="related-grid">
              ${related.map(p => {
                let img = p.media?.images?.[0]?.url || p.primaryImg || 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=200';
                return `
                  <div class="related-card border-2d border-2d-md" onclick="window.location='product.html?id=${p.id}'" style="--border-2d-offset: 4px;">
                    <div class="related-image">
                      <img src="${img}" alt="${p.title}">
                    </div>
                    <div class="related-category">${p.category}</div>
                    <div class="related-title-small">${p.title.substring(0, 30)}</div>
                    <div class="related-price">â‚¹${p.price.toFixed(2)}</div>
                    <div class="quick-add border-2d border-2d-sm" onclick="event.stopPropagation(); quickAdd('${p.id}')">
                      <i class="fa-solid fa-cart-plus"></i> QUICK ADD
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
        
        document.getElementById('product-container').insertAdjacentHTML('beforeend', html);
      } catch (e) {
        console.error('Related error:', e);
      }
    }

    // ========== UTILITIES ==========
    function getStars(rating) {
      let stars = '';
      const r = parseFloat(rating) || 0;
      for (let i = 1; i <= 5; i++) {
        if (r >= i) stars += '<i class="fa-solid fa-star"></i>';
        else if (r > i-1 && r < i) stars += '<i class="fa-solid fa-star-half-alt"></i>';
        else stars += '<i class="fa-regular fa-star"></i>';
      }
      return stars;
    }

    window.changeImage = function(src, el) {
      document.getElementById('mainImage').src = src;
      document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
    };

    // ========== DYNAMIC DELIVERY BAR ==========
    function updateDeliveryBar(total) {
      const progress = document.getElementById('deliveryProgress');
      const message = document.getElementById('deliveryMessage');
      const text = document.getElementById('deliveryText');
      if (!progress || !message || !text) return;

      const percent = Math.min(100, (total / 1299) * 100);
      progress.style.width = percent + '%';

      if (total >= 1299) {
        message.className = 'delivery-message eligible';
        message.querySelector('i').className = 'fa-solid fa-circle-check';
        text.innerHTML = 'ðŸŽ‰ You get FREE delivery!';
      } else {
        message.className = 'delivery-message not-eligible';
        message.querySelector('i').className = 'fa-solid fa-circle-info';
        text.innerHTML = `Add <span class="cart-value">â‚¹${(1299 - total).toFixed(2)}</span> more for free delivery`;
      }
    }

    // ========== QUANTITY HANDLER ==========
    window.updateQuantity = function(delta) {
      const input = document.getElementById('productQuantity');
      let val = parseInt(input.value) || 1;
      const stock = currentProduct?.stock || 0;
      
      val += delta;
      if (val < 1) val = 1;
      if (val > stock) val = stock;
      
      input.value = val;
      
      // Update delivery bar
      if (currentProduct) {
        updateDeliveryBar(currentProduct.price * val);
      }
      
      // Update plus/minus buttons
      const plus = document.querySelector('.quantity-btn[onclick*="updateQuantity(1)"]');
      const minus = document.querySelector('.quantity-btn[onclick*="updateQuantity(-1)"]');
      if (plus) plus.disabled = val >= stock;
      if (minus) minus.disabled = val <= 1;
    };

    // ========== SHARE ==========
    window.toggleShare = function(e) {
      e.stopPropagation();
      const menu = document.getElementById('shareMenu');
      menu.classList.toggle('show');
      if (menu.classList.contains('show')) {
        setTimeout(() => document.addEventListener('click', closeShareOutside), 100);
      }
    };

    window.closeShare = function() {
      document.getElementById('shareMenu')?.classList.remove('show');
      document.removeEventListener('click', closeShareOutside);
    };

    function closeShareOutside(e) {
      const menu = document.getElementById('shareMenu');
      const btn = document.querySelector('.share-main-btn');
      if (!menu.contains(e.target) && !btn.contains(e.target)) closeShare();
    }

    window.share = function(platform) {
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(currentProduct?.title || 'Product');
      let link = '';
      if (platform === 'facebook') link = `https://facebook.com/sharer/sharer.php?u=${url}`;
      if (platform === 'twitter') link = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
      if (platform === 'whatsapp') link = `https://wa.me/?text=${title}%20${url}`;
      if (platform === 'telegram') link = `https://t.me/share/url?url=${url}&text=${title}`;
      if (platform === 'email') link = `mailto:?subject=${title}&body=${url}`;
      if (platform === 'pinterest') link = `https://pinterest.com/pin/create/button/?url=${url}&description=${title}`;
      if (link) window.open(link, '_blank', 'width=600,height=400');
      closeShare();
    };

    window.copyLink = function() {
      const input = document.getElementById('shareLink');
      input.select();
      navigator.clipboard.writeText(input.value).then(() => {
        const btn = document.querySelector('.copy-link-btn');
        btn.innerHTML = '<i class="fa-solid fa-check"></i> COPIED!';
        setTimeout(() => {
          btn.innerHTML = '<i class="fa-regular fa-copy"></i> COPY';
        }, 2000);
      });
    };

    // ========== CART ACTIONS ==========
    window.addToCart = function() {
      const qty = parseInt(document.getElementById('productQuantity')?.value) || 1;
      const existing = cart.find(i => i.id === currentProduct.id);
      
      if (existing) {
        existing.quantity += qty;
      } else {
        cart.push({
          id: currentProduct.id,
          title: currentProduct.title,
          price: currentProduct.price,
          quantity: qty,
          image: currentProduct.media?.images?.[0]?.url || currentProduct.primaryImg
        });
      }
      
      localStorage.setItem('myessantia_cart', JSON.stringify(cart));
      showNotification('Product added to cart!');
      
      const btn = event?.target?.closest('button');
      if (btn && btn.classList.contains('btn-add-to-cart')) {
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-check"></i> ADDED!';
        btn.style.background = '#22c55e';
        btn.style.color = 'white';
        setTimeout(() => {
          btn.innerHTML = original;
          btn.style.background = '';
          btn.style.color = '';
        }, 1500);
      }
    };

    window.buyNow = function() {
      if (currentProduct?.highDemand) {
        alert('High demand product! Priority access modal would appear here.');
      } else {
        addToCart();
        setTimeout(() => {
          window.location.href = 'checkout.html';
        }, 800);
      }
    };

    window.quickAdd = function(id) {
      showNotification('Quick add - coming soon!');
    };

    function showNotification(msg) {
      const existing = document.querySelector('.cart-notification');
      if (existing) existing.remove();

      const notif = document.createElement('div');
      notif.className = 'cart-notification border-2d border-2d-md';
      notif.style = '--border-2d-color: rgba(255,255,255,0.3); --border-2d-offset: 4px;';
      notif.innerHTML = `<i class="fa-solid fa-check-circle"></i> ${msg} <button onclick="this.parentElement.remove()">VIEW CART</button>`;
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 3000);
    }

    // ========== TABS ==========
    window.switchTab = function(tab) {
      document.querySelectorAll('.tab-header').forEach(h => h.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`.tab-header[onclick="switchTab('${tab}')"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');
    };

    // ========== INIT ==========
    document.addEventListener('DOMContentLoaded', loadProduct);
  </script>
</body>
</html>
