<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>MyEssantia · product</title>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  
  <style>
    /* ========== CLEAN MODERN DESIGN ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      overflow-x: hidden;
      background: #f8fafc;
    }

    body {
      font-family: 'Inter', sans-serif;
      color: #1e293b;
      line-height: 1.5;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* ========== BREADCRUMB ========== */
    .breadcrumb {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      padding: 20px 0;
      font-size: 0.85rem;
      color: #64748b;
    }

    .breadcrumb a {
      color: #1e293b;
      text-decoration: none;
      font-weight: 500;
    }

    .breadcrumb i {
      font-size: 0.7rem;
      color: #94a3b8;
    }

    /* ========== MAIN GRID ========== */
    .product-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 32px;
      padding-bottom: 60px;
    }

    @media (min-width: 1024px) {
      .product-grid {
        grid-template-columns: 1fr 1fr;
        gap: 60px;
      }
    }

    /* ========== GALLERY ========== */
    .gallery-section {
      width: 100%;
    }

    @media (min-width: 1024px) {
      .gallery-section {
        position: sticky;
        top: 20px;
        height: fit-content;
      }
    }

    .main-image {
      width: 100%;
      aspect-ratio: 1/1;
      border-radius: 24px;
      overflow: hidden;
      margin-bottom: 16px;
      background: #ffffff;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .main-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .thumbnail-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .thumbnail {
      aspect-ratio: 1/1;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      background: #ffffff;
      border: 1px solid #e2e8f0;
    }

    .thumbnail.active {
      border-color: #2563eb;
    }

    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========== DESKTOP REVIEWS ========== */
    .desktop-reviews {
      display: none;
      margin-top: 24px;
    }

    @media (min-width: 1024px) {
      .desktop-reviews {
        display: block;
      }
    }

    .review-mini-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    }

    .review-mini-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-weight: 600;
      color: #1e293b;
    }

    .review-mini-item {
      display: flex;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid #f1f5f9;
    }

    .review-mini-item:last-child {
      border-bottom: none;
    }

    .review-mini-avatar {
      width: 44px;
      height: 44px;
      background: #dbeafe;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #2563eb;
      flex-shrink: 0;
    }

    /* ========== PRODUCT INFO ========== */
    .product-info {
      width: 100%;
    }

    /* Social Badges */
    .social-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 16px;
    }

    .sold-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #fee2e2;
      color: #dc2626;
      padding: 6px 16px;
      border-radius: 100px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .live-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #dcfce7;
      color: #16a34a;
      padding: 6px 16px;
      border-radius: 100px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .live-badge i {
      font-size: 0.6rem;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.3; }
      100% { opacity: 1; }
    }

    .product-category {
      font-size: 0.9rem;
      font-weight: 600;
      color: #2563eb;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .product-title {
      font-size: 2.2rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 16px;
      color: #0f172a;
    }

    @media (min-width: 768px) {
      .product-title {
        font-size: 2.8rem;
      }
    }

    /* Rating Row */
    .rating-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .stars {
      display: flex;
      gap: 4px;
      color: #fbbf24;
      font-size: 1rem;
    }

    /* Share Button */
    .share-wrapper {
      position: relative;
      margin-left: auto;
    }

    .share-btn {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      padding: 8px 20px;
      border-radius: 100px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #1e293b;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .share-btn:hover {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .share-menu {
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
      padding: 20px;
      width: 280px;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      border: 1px solid #e2e8f0;
    }

    .share-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .share-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    .share-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 10px 4px;
      border-radius: 12px;
      background: #f8fafc;
      border: none;
      font-size: 0.7rem;
      font-weight: 500;
      cursor: pointer;
    }

    .share-option i {
      font-size: 1.1rem;
      color: #2563eb;
    }

    .copy-link {
      display: flex;
      gap: 8px;
    }

    .copy-link input {
      flex: 1;
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      font-size: 0.8rem;
    }

    .copy-btn {
      padding: 10px 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
    }

    /* Price Card */
    .price-card {
      background: #ffffff;
      border-radius: 24px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    }

    .price-header {
      display: flex;
      align-items: baseline;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .current-price {
      font-size: 2.8rem;
      font-weight: 800;
      color: #0f172a;
      line-height: 1;
    }

    .inr-symbol {
      font-size: 2rem;
      font-weight: 600;
      color: #64748b;
    }

    .original-price {
      font-size: 1.3rem;
      color: #94a3b8;
      text-decoration: line-through;
    }

    .discount {
      background: #dcfce7;
      color: #16a34a;
      padding: 4px 12px;
      border-radius: 100px;
      font-weight: 700;
      font-size: 0.9rem;
    }

    /* Price Options */
    .price-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .price-option {
      padding: 16px;
      border-radius: 16px;
      text-align: center;
      border: 1px solid;
    }

    .price-option.prepaid {
      background: #eff6ff;
      border-color: #bfdbfe;
    }

    .price-option.cod {
      background: #f8fafc;
      border-color: #e2e8f0;
    }

    .option-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .price-option.prepaid .option-label {
      color: #2563eb;
    }

    .option-price {
      font-size: 1.8rem;
      font-weight: 700;
      color: #0f172a;
      line-height: 1.2;
    }

    .stock-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 20px;
      background: #f8fafc;
      border-radius: 100px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #1e293b;
      border: 1px solid #e2e8f0;
    }

    /* Money Back Promise */
    .promise-card {
      background: #eff6ff;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      border: 1px solid #bfdbfe;
    }

    .promise-icon {
      width: 52px;
      height: 52px;
      background: #ffffff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #2563eb;
      font-size: 1.5rem;
      flex-shrink: 0;
      border: 1px solid #bfdbfe;
    }

    .promise-content h4 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 4px;
      color: #1e293b;
    }

    .promise-content p {
      font-size: 0.9rem;
      color: #475569;
    }

    /* Delivery Card */
    .delivery-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid #e2e8f0;
    }

    .delivery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .delivery-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #1e293b;
    }

    .delivery-title i {
      color: #2563eb;
    }

    .delivery-min {
      background: #f8fafc;
      padding: 4px 12px;
      border-radius: 100px;
      font-size: 0.8rem;
      font-weight: 500;
      color: #475569;
    }

    .progress-bar {
      height: 8px;
      background: #f1f5f9;
      border-radius: 10px;
      overflow: hidden;
      margin: 12px 0;
    }

    .progress-fill {
      height: 100%;
      background: #2563eb;
      width: 0%;
      transition: width 0.3s;
    }

    .delivery-message {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #1e293b;
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Features Grid */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .feature-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: #f8fafc;
      border-radius: 16px;
      border: 1px solid #e2e8f0;
    }

    .feature-icon {
      width: 40px;
      height: 40px;
      background: #ffffff;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #2563eb;
      border: 1px solid #e2e8f0;
    }

    .feature-text h4 {
      font-size: 0.9rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 2px;
    }

    .feature-text p {
      font-size: 0.75rem;
      color: #64748b;
    }

    /* Quantity */
    .quantity-wrapper {
      background: #ffffff;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid #e2e8f0;
    }

    .quantity-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 16px;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .qty-btn {
      width: 44px;
      height: 44px;
      border: 1px solid #e2e8f0;
      background: #ffffff;
      border-radius: 12px;
      font-size: 1.3rem;
      font-weight: 600;
      color: #1e293b;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qty-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .qty-input {
      width: 70px;
      height: 44px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
      background: #ffffff;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 32px;
    }

    @media (min-width: 480px) {
      .action-buttons {
        flex-direction: row;
      }
    }

    .btn {
      flex: 1;
      padding: 16px;
      border: none;
      border-radius: 100px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
      box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: #ffffff;
      color: #1e293b;
      border: 1px solid #e2e8f0;
    }

    .btn-secondary:hover {
      background: #f8fafc;
    }

    /* Tabs */
    .tabs {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid #e2e8f0;
    }

    .tab-headers {
      display: flex;
      gap: 24px;
      border-bottom: 1px solid #f1f5f9;
      margin-bottom: 20px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .tab-headers::-webkit-scrollbar {
      display: none;
    }

    .tab-header {
      padding: 12px 0;
      cursor: pointer;
      font-weight: 600;
      color: #94a3b8;
      font-size: 0.95rem;
      white-space: nowrap;
      border-bottom: 2px solid transparent;
    }

    .tab-header.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    .tab-content {
      display: none;
      color: #475569;
      font-size: 0.95rem;
      line-height: 1.7;
    }

    .tab-content.active {
      display: block;
    }

    .specs-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 480px) {
      .specs-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .spec-item {
      padding: 16px;
      background: #f8fafc;
      border-radius: 12px;
    }

    .spec-label {
      font-size: 0.8rem;
      color: #64748b;
      margin-bottom: 4px;
    }

    .spec-value {
      font-weight: 700;
      color: #1e293b;
    }

    .video-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 480px) {
      .video-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .video-item {
      aspect-ratio: 16/9;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      border: 1px solid #e2e8f0;
    }

    .video-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-item i {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 44px;
      height: 44px;
      background: #ffffff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #2563eb;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    }

    /* Mobile Reviews */
    .mobile-reviews {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      border: 1px solid #e2e8f0;
    }

    @media (min-width: 1024px) {
      .mobile-reviews {
        display: none;
      }
    }

    .reviews-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-weight: 700;
      color: #1e293b;
    }

    .reviews-grid {
      display: grid;
      gap: 16px;
    }

    .review-card {
      padding: 20px;
      background: #f8fafc;
      border-radius: 16px;
    }

    .reviewer {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .reviewer-avatar {
      width: 44px;
      height: 44px;
      background: #dbeafe;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #2563eb;
    }

    .reviewer-info h5 {
      font-size: 1rem;
      font-weight: 700;
      color: #1e293b;
    }

    .reviewer-info span {
      font-size: 0.8rem;
      color: #64748b;
    }

    .review-rating {
      color: #fbbf24;
      margin-bottom: 8px;
    }

    .review-text {
      color: #475569;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* Related Products */
    .related {
      margin-top: 48px;
      padding-top: 32px;
    }

    .related-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 24px;
      color: #0f172a;
    }

    .related-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    @media (min-width: 640px) {
      .related-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .related-card {
      text-decoration: none;
      color: inherit;
      background: #ffffff;
      border-radius: 20px;
      padding: 16px;
      border: 1px solid #e2e8f0;
      transition: all 0.2s;
    }

    .related-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
    }

    .related-image {
      aspect-ratio: 1/1;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 12px;
      background: #f8fafc;
    }

    .related-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .related-name {
      font-size: 0.9rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 4px;
    }

    .related-price {
      font-weight: 700;
      color: #2563eb;
      font-size: 1.1rem;
      margin-bottom: 12px;
    }

    .related-add {
      padding: 10px;
      background: #f8fafc;
      border-radius: 100px;
      text-align: center;
      font-size: 0.8rem;
      font-weight: 600;
      color: #1e293b;
      border: 1px solid #e2e8f0;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      left: 20px;
      right: 20px;
      max-width: 360px;
      margin: 0 auto;
      background: #ffffff;
      color: #1e293b;
      padding: 16px 20px;
      border-radius: 100px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
      z-index: 1000;
      animation: slideDown 0.3s ease;
      border: 1px solid #e2e8f0;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
    }

    @keyframes slideDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Scroll Top */
    .scroll-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 48px;
      height: 48px;
      background: #ffffff;
      color: #2563eb;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #e2e8f0;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 90;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    }

    .scroll-top.visible {
      opacity: 1;
    }

    /* Utility */
    .text-blue {
      color: #2563eb;
    }
  </style>
</head>
<body>

  <div id="header"></div>
  <div class="scroll-top" id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})"><i class="fa-solid fa-arrow-up"></i></div>

  <main>
    <div class="container">
      <div class="breadcrumb">
        <a href="index.html">Home</a>
        <i class="fa-solid fa-chevron-right"></i>
        <a href="collection.html">Collection</a>
        <i class="fa-solid fa-chevron-right"></i>
        <span id="breadcrumb-product">Loading...</span>
      </div>
    </div>

    <div class="container" id="product-container"></div>
  </main>

  <div id="footer"></div>

  <script>
    // ========== FIREBASE CONFIG ==========
    const firebaseConfig = {
      apiKey: "AIzaSyD16uGnm1vodkbqGoFSdFdJjGFSLpJmflk",
      authDomain: "myessantia.firebaseapp.com",
      projectId: "myessantia",
      storageBucket: "myessantia.firebasestorage.app",
      messagingSenderId: "701726517205",
      appId: "1:701726517205:web:f6ab79efdffeab6dbbbf5c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ========== GLOBAL ==========
    let currentProduct = null;
    let cart = JSON.parse(localStorage.getItem('myessantia_cart')) || [];

    function getRandomSold() {
      return Math.floor(Math.random() * (2000 - 500 + 1)) + 500;
    }

    function getRandomViewers() {
      return Math.floor(Math.random() * (35 - 8 + 1)) + 8;
    }

    function generateReviews() {
      const users = [
        { name: 'Priya Sharma', city: 'Mumbai', avatar: 'PS' },
        { name: 'Rahul Verma', city: 'Delhi', avatar: 'RV' },
        { name: 'Ananya Patel', city: 'Bangalore', avatar: 'AP' },
        { name: 'Karthik Iyer', city: 'Chennai', avatar: 'KI' }
      ];
      
      const comments = [
        "Absolutely love this! Quality is amazing and delivery was super fast.",
        "Perfect product, exceeded my expectations. Worth every penny!",
        "Great quality and beautiful design. Highly recommend!",
        "Excellent value for money. Will buy again."
      ];
      
      return users.map((user, i) => ({
        ...user,
        comment: comments[i % comments.length],
        rating: (4 + Math.random() * 0.9).toFixed(1),
        time: Math.floor(Math.random() * 48) + 1,
        helpful: Math.floor(Math.random() * 30) + 10
      }));
    }

    function getProductId() {
      return new URLSearchParams(window.location.search).get('id');
    }

    async function loadProduct() {
      const productId = getProductId();
      if (!productId) return showNotFound();

      try {
        const doc = await db.collection('products').doc(productId).get();
        if (!doc.exists) return showNotFound();

        currentProduct = { id: doc.id, ...doc.data() };
        document.getElementById('breadcrumb-product').textContent = currentProduct.title;
        renderProduct(currentProduct);
        loadRelated(currentProduct);
      } catch (error) {
        console.error(error);
        showNotFound();
      }
    }

    function showNotFound() {
      document.getElementById('product-container').innerHTML = `
        <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 24px; border: 1px solid #e2e8f0;">
          <i class="fa-solid fa-box-open" style="font-size: 48px; color: #2563eb;"></i>
          <h2 style="font-size: 1.8rem; margin: 16px 0; color: #1e293b;">Product Not Found</h2>
          <a href="collection.html" style="display: inline-block; padding: 12px 32px; background: #2563eb; color: white; text-decoration: none; border-radius: 100px; font-weight: 600;">Browse Collection</a>
        </div>
      `;
    }

    function renderProduct(product) {
      const images = [];
      if (product.media?.images) images.push(...product.media.images.map(i => i.url));
      if (images.length === 0) images.push(product.primaryImg || 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=600');

      const stock = product.stock || 10;
      const originalPrice = Math.round(product.price * 1.25);
      const discount = Math.round(((originalPrice - product.price) / originalPrice) * 100);
      const prepaidPrice = Math.round(product.price * 0.92);
      const codPrice = Math.round(product.price * 1.04);
      
      const soldCount = getRandomSold();
      const liveViewers = getRandomViewers();
      const reviews = generateReviews();

      const container = document.getElementById('product-container');
      container.innerHTML = `
        <div class="product-grid">
          <!-- Gallery -->
          <div class="gallery-section">
            <div class="main-image">
              <img src="${images[0]}" alt="${product.title}" id="mainImage">
            </div>
            <div class="thumbnail-grid">
              ${images.map((img, i) => `
                <div class="thumbnail ${i === 0 ? 'active' : ''}" onclick="changeImage('${img}', this)">
                  <img src="${img}" alt="thumb">
                </div>
              `).join('')}
            </div>
            
            <!-- Desktop Reviews -->
            <div class="desktop-reviews">
              <div class="review-mini-card">
                <div class="review-mini-header">
                  <span>Customer Reviews</span>
                  <span style="color:#2563eb; font-weight:700;">★ ${(product.rating || 4.5).toFixed(1)}</span>
                </div>
                ${reviews.slice(0, 3).map(r => `
                  <div class="review-mini-item">
                    <div class="review-mini-avatar">${r.avatar}</div>
                    <div style="flex:1">
                      <div style="font-weight:700; font-size:0.9rem;">${r.name}</div>
                      <div style="color:#fbbf24; font-size:0.8rem; margin:2px 0;">${'★'.repeat(Math.floor(r.rating))}</div>
                      <div style="font-size:0.8rem; color:#64748b;">"${r.comment.substring(0,50)}..."</div>
                    </div>
                  </div>
                `).join('')}
                <div style="text-align:center; margin-top:16px; font-weight:600; color:#2563eb;">View all 128 reviews →</div>
              </div>
            </div>
          </div>

          <!-- Product Info -->
          <div class="product-info">
            <!-- Social Badges -->
            <div class="social-strip">
              <span class="sold-badge"><i class="fa-solid fa-fire"></i> ${soldCount}+ sold</span>
              <span class="live-badge"><i class="fa-solid fa-circle"></i> ${liveViewers} viewing now</span>
            </div>

            <div class="product-category">${product.category || 'Accessories'}</div>
            <h1 class="product-title">${product.title}</h1>

            <!-- Rating & Share -->
            <div class="rating-row">
              <div class="stars">${getStars(product.rating)}</div>
              <span style="font-weight:600;">${(product.rating || 4.5).toFixed(1)}</span>
              <span style="color:#64748b;">(128 reviews)</span>
              
              <div class="share-wrapper">
                <button class="share-btn" onclick="toggleShare(event)"><i class="fa-solid fa-share-alt"></i> Share</button>
                <div class="share-menu" id="shareMenu">
                  <div class="share-grid">
                    <button class="share-option" onclick="share('facebook')"><i class="fa-brands fa-facebook-f"></i>FB</button>
                    <button class="share-option" onclick="share('twitter')"><i class="fa-brands fa-x-twitter"></i>TW</button>
                    <button class="share-option" onclick="share('whatsapp')"><i class="fa-brands fa-whatsapp"></i>WA</button>
                    <button class="share-option" onclick="share('telegram')"><i class="fa-brands fa-telegram"></i>TG</button>
                    <button class="share-option" onclick="share('email')"><i class="fa-regular fa-envelope"></i>Mail</button>
                    <button class="share-option" onclick="share('pinterest')"><i class="fa-brands fa-pinterest"></i>Pin</button>
                  </div>
                  <div class="copy-link">
                    <input type="text" id="shareLink" value="${window.location.href}" readonly>
                    <button class="copy-btn" onclick="copyLink()">Copy</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Price Card -->
            <div class="price-card">
              <div class="price-header">
                <span class="current-price"><span class="inr-symbol">₹</span>${product.price.toFixed(2)}</span>
                <span class="original-price">₹${originalPrice.toFixed(2)}</span>
                <span class="discount">-${discount}%</span>
              </div>
              
              <div class="price-options">
                <div class="price-option prepaid">
                  <div class="option-label">Prepaid</div>
                  <div class="option-price">₹${prepaidPrice}</div>
                  <div style="font-size:0.75rem; color:#2563eb;">Save ₹${product.price - prepaidPrice}</div>
                </div>
                <div class="price-option cod">
                  <div class="option-label">Cash on Delivery</div>
                  <div class="option-price">₹${codPrice}</div>
                  <div style="font-size:0.75rem; color:#94a3b8;">+₹${codPrice - product.price} fee</div>
                </div>
              </div>

              <span class="stock-badge">
                <i class="fa-solid ${stock > 10 ? 'fa-check-circle text-blue' : 'fa-exclamation-circle'}" style="color:${stock > 10 ? '#2563eb' : '#f59e0b'};"></i>
                ${stock > 10 ? 'In Stock' : `Only ${stock} left`}
              </span>
            </div>

            <!-- Money Back -->
            <div class="promise-card">
              <div class="promise-icon"><i class="fa-solid fa-shield"></i></div>
              <div class="promise-content">
                <h4>Razorpay Money Back Promise</h4>
                <p><span style="font-weight:700;">100% refund</span> on non-delivery or defects</p>
              </div>
            </div>

            <!-- Delivery -->
            <div class="delivery-card" id="deliveryCard">
              <div class="delivery-header">
                <span class="delivery-title"><i class="fa-solid fa-truck"></i> Free Delivery</span>
                <span class="delivery-min">Min. ₹1,299</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="deliveryProgress" style="width: ${Math.min(100, (product.price / 1299) * 100)}%"></div>
              </div>
              <div class="delivery-message" id="deliveryMessage">
                <i class="fa-solid ${product.price >= 1299 ? 'fa-circle-check' : 'fa-circle-info'}" style="color:${product.price >= 1299 ? '#16a34a' : '#2563eb'};"></i>
                <span id="deliveryText">
                  ${product.price >= 1299 ? 'You get free delivery!' : `Add <span style="font-weight:700; color:#2563eb;">₹${(1299 - product.price).toFixed(2)}</span> more for free delivery`}
                </span>
              </div>
            </div>

            <!-- Features -->
            <div class="features-grid">
              <div class="feature-item">
                <div class="feature-icon"><i class="fa-solid fa-truck-fast"></i></div>
                <div><h4>Free Shipping</h4><p>Above ₹1,299</p></div>
              </div>
              <div class="feature-item">
                <div class="feature-icon"><i class="fa-solid fa-rotate-left"></i></div>
                <div><h4>Easy Returns</h4><p>48 hours</p></div>
              </div>
            </div>

            <!-- Quantity -->
            <div class="quantity-wrapper">
              <div class="quantity-label"><i class="fa-solid fa-cubes" style="color:#2563eb;"></i> Quantity</div>
              <div class="quantity-controls">
                <button class="qty-btn" onclick="updateQuantity(-1)" ${stock === 0 ? 'disabled' : ''}>−</button>
                <input type="text" class="qty-input" id="productQuantity" value="1" readonly>
                <button class="qty-btn" onclick="updateQuantity(1)" ${stock === 0 ? 'disabled' : ''}>+</button>
              </div>
            </div>

            <!-- Buttons -->
            <div class="action-buttons">
              <button class="btn btn-secondary" onclick="addToCart()" ${stock === 0 ? 'disabled' : ''}>
                <i class="fa-solid fa-cart-plus"></i> Add to Cart
              </button>
              <button class="btn btn-primary" onclick="buyNow()" ${stock === 0 ? 'disabled' : ''}>
                <i class="fa-solid fa-bolt"></i> Buy Now
              </button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
              <div class="tab-headers">
                <div class="tab-header active" onclick="switchTab('desc')">Description</div>
                <div class="tab-header" onclick="switchTab('specs')">Specs</div>
                <div class="tab-header" onclick="switchTab('videos')">Videos</div>
              </div>
              <div class="tab-content active" id="tab-desc">
                <p>${product.description || product.shortDesc || 'Premium quality product from MyEssantia.'}</p>
              </div>
              <div class="tab-content" id="tab-specs">
                <div class="specs-grid">
                  <div class="spec-item"><div class="spec-label">Material</div><div class="spec-value">Premium Quality</div></div>
                  <div class="spec-item"><div class="spec-label">Brand</div><div class="spec-value">${product.brand || 'MyEssantia'}</div></div>
                </div>
              </div>
              <div class="tab-content" id="tab-videos">
                <div class="video-grid">
                  <div class="video-item"><img src="https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400"><i class="fa-solid fa-play"></i></div>
                  <div class="video-item"><img src="https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400"><i class="fa-solid fa-play"></i></div>
                </div>
              </div>
            </div>

            <!-- Mobile Reviews -->
            <div class="mobile-reviews">
              <div class="reviews-header">
                <span>Customer Reviews</span>
                <span style="color:#2563eb;">★ ${(product.rating || 4.5).toFixed(1)}</span>
              </div>
              <div class="reviews-grid">
                ${reviews.slice(0, 3).map(r => `
                  <div class="review-card">
                    <div class="reviewer">
                      <div class="reviewer-avatar">${r.avatar}</div>
                      <div class="reviewer-info">
                        <h5>${r.name}</h5>
                        <span>${r.city} · ${r.time}h ago</span>
                      </div>
                    </div>
                    <div class="review-rating">${'★'.repeat(Math.floor(r.rating))}</div>
                    <div class="review-text">"${r.comment}"</div>
                  </div>
                `).join('')}
              </div>
              <div style="text-align:center; margin-top:16px; font-weight:600; color:#2563eb;">View all 128 reviews →</div>
            </div>
          </div>
        </div>
      `;

      updateDeliveryBar(product.price);
      setupScrollTop();
    }

    function setupScrollTop() {
      const btn = document.getElementById('scrollTop');
      window.addEventListener('scroll', () => {
        btn.classList.toggle('visible', window.scrollY > 200);
      });
    }

    async function loadRelated(product) {
      try {
        const snap = await db.collection('products')
          .where('category', '==', product.category)
          .limit(5)
          .get();
        
        const related = snap.docs
          .map(d => ({ id: d.id, ...d.data() }))
          .filter(p => p.id !== product.id)
          .slice(0, 4);

        if (related.length === 0) return;

        const html = `
          <div class="related">
            <h2 class="related-title">You May Also Like</h2>
            <div class="related-grid">
              ${related.map(p => {
                const img = p.media?.images?.[0]?.url || p.primaryImg || 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=200';
                return `
                  <a href="product.html?id=${p.id}" class="related-card">
                    <div class="related-image"><img src="${img}" alt=""></div>
                    <div class="related-name">${p.title.substring(0, 25)}</div>
                    <div class="related-price">₹${p.price.toFixed(2)}</div>
                    <div class="related-add">Quick Add</div>
                  </a>
                `;
              }).join('')}
            </div>
          </div>
        `;
        
        document.getElementById('product-container').insertAdjacentHTML('beforeend', html);
      } catch (e) {}
    }

    function getStars(rating) {
      const r = parseFloat(rating) || 4.5;
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        if (r >= i) stars += '<i class="fa-solid fa-star"></i>';
        else if (r > i-1 && r < i) stars += '<i class="fa-solid fa-star-half-alt"></i>';
        else stars += '<i class="fa-regular fa-star"></i>';
      }
      return stars;
    }

    window.changeImage = function(src, el) {
      document.getElementById('mainImage').src = src;
      document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
    };

    window.updateQuantity = function(delta) {
      const input = document.getElementById('productQuantity');
      let val = parseInt(input.value) || 1;
      val += delta;
      if (val < 1) val = 1;
      if (currentProduct && val > currentProduct.stock) val = currentProduct.stock;
      input.value = val;
      if (currentProduct) updateDeliveryBar(currentProduct.price * val);
    };

    function updateDeliveryBar(total) {
      const progress = document.getElementById('deliveryProgress');
      const text = document.getElementById('deliveryText');
      if (!progress || !text) return;
      progress.style.width = Math.min(100, (total / 1299) * 100) + '%';
      text.innerHTML = total >= 1299 ? 'You get free delivery!' : `Add <span style="font-weight:700; color:#2563eb;">₹${(1299 - total).toFixed(2)}</span> more for free delivery`;
    }

    // Share Functions
    window.toggleShare = function(e) {
      e.stopPropagation();
      const menu = document.getElementById('shareMenu');
      menu.classList.toggle('show');
      if (menu.classList.contains('show')) {
        setTimeout(() => document.addEventListener('click', closeShare), 100);
      }
    };

    function closeShare(e) {
      const menu = document.getElementById('shareMenu');
      const btn = document.querySelector('.share-btn');
      if (menu && !menu.contains(e.target) && !btn.contains(e.target)) {
        menu.classList.remove('show');
        document.removeEventListener('click', closeShare);
      }
    }

    window.share = function(platform) {
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(currentProduct?.title || 'Product');
      let link = '';
      if (platform === 'facebook') link = `https://facebook.com/sharer/sharer.php?u=${url}`;
      if (platform === 'twitter') link = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
      if (platform === 'whatsapp') link = `https://wa.me/?text=${title}%20${url}`;
      if (platform === 'telegram') link = `https://t.me/share/url?url=${url}&text=${title}`;
      if (platform === 'email') link = `mailto:?subject=${title}&body=${url}`;
      if (platform === 'pinterest') link = `https://pinterest.com/pin/create/button/?url=${url}&description=${title}`;
      if (link) window.open(link, '_blank', 'width=600,height=400');
      document.getElementById('shareMenu')?.classList.remove('show');
    };

    window.copyLink = function() {
      const input = document.getElementById('shareLink');
      input.select();
      navigator.clipboard.writeText(input.value).then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 2000);
      });
    };

    // Cart
    window.addToCart = function() {
      showNotification('Added to cart!');
      const btn = event?.target?.closest('button');
      if (btn && btn.classList.contains('btn-secondary')) {
        btn.innerHTML = '<i class="fa-solid fa-check"></i> Added!';
        btn.style.background = '#16a34a';
        btn.style.color = 'white';
        setTimeout(() => {
          btn.innerHTML = '<i class="fa-solid fa-cart-plus"></i> Add to Cart';
          btn.style.background = '';
          btn.style.color = '';
        }, 1500);
      }
    };

    window.buyNow = function() {
      addToCart();
      setTimeout(() => window.location.href = 'checkout.html', 800);
    };

    function showNotification(msg) {
      const existing = document.querySelector('.notification');
      if (existing) existing.remove();
      const notif = document.createElement('div');
      notif.className = 'notification';
      notif.innerHTML = `<i class="fa-solid fa-check-circle" style="color:#16a34a;"></i> ${msg}`;
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 3000);
    }

    window.switchTab = function(tab) {
      document.querySelectorAll('.tab-header').forEach(h => h.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`.tab-header[onclick="switchTab('${tab}')"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');
    };

    document.addEventListener('DOMContentLoaded', loadProduct);
  </script>
</body>
</html>
