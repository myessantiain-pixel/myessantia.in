<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>Product Â· MyEssantia</title>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Premium Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  
  <style>
    /* ========== EARTHY MODERN DESIGN SYSTEM ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Earthy, Sophisticated Color Palette */
      --primary: #8B7355;        /* Warm taupe */
      --primary-dark: #6B5840;
      --primary-light: #E8DFD1;
      --primary-soft: #F5F0E8;
      
      --secondary: #A67B5B;       /* Warm brown */
      --secondary-light: #E6D5C3;
      
      --accent-green: #4A7A6C;     /* Sage green for prepaid */
      --accent-green-light: #E4F0EC;
      --accent-orange: #C97C5D;    /* Terracotta for COD */
      --accent-orange-light: #F9EBE4;
      
      --dark: #2C2C2C;            /* Rich dark gray */
      --gray-800: #3E3E3E;
      --gray-600: #6B6B6B;
      --gray-400: #9E9E9E;
      --gray-200: #E8E8E8;
      --gray-100: #F5F5F5;
      --gray-50: #FAFAFA;
      
      --bg: #FFFFFF;
      --surface: #FCFAF7;
      --card: #FFFFFF;
      
      /* 2D Shadow Effect */
      --shadow-2d: 4px 4px 0 rgba(0, 0, 0, 0.2);
      --shadow-2d-hover: 6px 6px 0 rgba(0, 0, 0, 0.25);
      --shadow-2d-sm: 2px 2px 0 rgba(0, 0, 0, 0.15);
      --shadow-2d-lg: 8px 8px 0 rgba(0, 0, 0, 0.2);
      
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.1);
      
      --radius-xs: 4px;
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-2xl: 20px;
      --radius-3xl: 24px;
      --radius-full: 9999px;
      
      --spacing-1: 4px;
      --spacing-2: 8px;
      --spacing-3: 12px;
      --spacing-4: 16px;
      --spacing-5: 20px;
      --spacing-6: 24px;
      --spacing-8: 32px;
      --spacing-10: 40px;
      --spacing-12: 48px;
      --spacing-16: 64px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--dark);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 var(--spacing-4);
    }

    @media (min-width: 640px) {
      .container {
        padding: 0 var(--spacing-6);
      }
    }

    /* ========== BREADCRUMB ========== */
    .breadcrumb {
      display: flex;
      gap: var(--spacing-2);
      align-items: center;
      padding: var(--spacing-4) 0 var(--spacing-4);
      color: var(--gray-400);
      font-size: 0.8rem;
      font-weight: 500;
      flex-wrap: wrap;
    }

    @media (min-width: 768px) {
      .breadcrumb {
        padding: var(--spacing-6) 0 var(--spacing-5);
        font-size: 0.9rem;
      }
    }

    .breadcrumb a {
      color: var(--gray-600);
      text-decoration: none;
      transition: color 0.2s;
    }

    .breadcrumb a:hover {
      color: var(--primary);
    }

    .breadcrumb i {
      font-size: 0.65rem;
      color: var(--gray-400);
    }

    /* ========== MAIN GRID ========== */
    .product-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-6);
      padding: 0 0 var(--spacing-10);
    }

    @media (min-width: 1024px) {
      .product-grid {
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-12);
      }
    }

    /* ========== GALLERY ========== */
    .gallery-section {
      width: 100%;
    }

    @media (min-width: 1024px) {
      .gallery-section {
        position: sticky;
        top: var(--spacing-6);
        height: fit-content;
      }
    }

    .main-image {
      width: 100%;
      aspect-ratio: 1;
      border-radius: var(--radius-xl);
      overflow: hidden;
      background: var(--surface);
      margin-bottom: var(--spacing-3);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d);
      transition: all 0.3s ease;
    }

    .main-image:hover {
      transform: translate(-2px, -2px);
      box-shadow: var(--shadow-2d-hover);
    }

    .main-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .main-image:hover img {
      transform: scale(1.03);
    }

    .thumbnail-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-2);
    }

    .thumbnail {
      aspect-ratio: 1;
      border-radius: var(--radius-lg);
      overflow: hidden;
      cursor: pointer;
      border: 2px solid var(--gray-200);
      transition: all 0.2s;
      background: var(--surface);
      box-shadow: var(--shadow-2d-sm);
    }

    .thumbnail:hover,
    .thumbnail.active {
      border-color: var(--primary);
      transform: translate(-1px, -1px);
      box-shadow: var(--shadow-2d);
    }

    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ========== REVIEWS UNDER GALLERY (DESKTOP ONLY) ========== */
    .gallery-reviews {
      display: none;
      margin-top: var(--spacing-6);
    }

    @media (min-width: 1024px) {
      .gallery-reviews {
        display: block;
      }
    }

    .reviews-mini {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-5);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d);
    }

    .reviews-mini-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-4);
    }

    .reviews-mini-header h4 {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .reviews-mini-header span {
      color: var(--primary);
      font-weight: 600;
    }

    .review-mini-item {
      display: flex;
      gap: var(--spacing-3);
      padding: var(--spacing-3) 0;
      border-bottom: 1px solid var(--gray-200);
    }

    .review-mini-item:last-child {
      border-bottom: none;
    }

    .review-mini-avatar {
      width: 40px;
      height: 40px;
      background: var(--primary-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--primary);
      flex-shrink: 0;
    }

    .review-mini-content {
      flex: 1;
    }

    .review-mini-name {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    .review-mini-rating {
      color: #fbbf24;
      font-size: 0.7rem;
      margin-bottom: 4px;
    }

    .review-mini-text {
      font-size: 0.85rem;
      color: var(--gray-600);
      line-height: 1.4;
    }

    .view-all-reviews {
      text-align: center;
      margin-top: var(--spacing-4);
      padding: var(--spacing-3);
      background: var(--gray-100);
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--primary);
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--gray-200);
    }

    .view-all-reviews:hover {
      background: var(--primary-light);
      transform: translate(-1px, -1px);
      box-shadow: var(--shadow-2d-sm);
    }

    /* ========== PRODUCT INFO ========== */
    .product-info {
      padding: 0;
    }

    /* Social Proof Strip - Mobile Optimized */
    .social-strip {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-2);
      margin-bottom: var(--spacing-4);
    }

    .sold-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-2);
      background: linear-gradient(135deg, #B76E79, #9B5A65); /* Rose gold */
      color: white;
      padding: var(--spacing-2) var(--spacing-3);
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 600;
      box-shadow: var(--shadow-2d-sm);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .live-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-2);
      background: linear-gradient(135deg, #4A7A6C, #2D5A4C); /* Deep teal */
      color: white;
      padding: var(--spacing-2) var(--spacing-3);
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 600;
      box-shadow: var(--shadow-2d-sm);
      animation: pulse 2s infinite;
    }

    .live-badge i {
      font-size: 0.5rem;
      color: #fff;
      animation: blink 1.5s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(74, 122, 108, 0.4); }
      70% { box-shadow: 0 0 0 8px rgba(74, 122, 108, 0); }
      100% { box-shadow: 0 0 0 0 rgba(74, 122, 108, 0); }
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.3; }
      100% { opacity: 1; }
    }

    .product-category {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--primary);
      margin-bottom: var(--spacing-2);
    }

    .product-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      line-height: 1.1;
      color: var(--dark);
      margin-bottom: var(--spacing-3);
      letter-spacing: -0.02em;
    }

    @media (min-width: 768px) {
      .product-title {
        font-size: 2.8rem;
      }
    }

    /* Rating Row - Mobile Optimized */
    .rating-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--spacing-3);
      margin-bottom: var(--spacing-5);
    }

    .stars {
      display: flex;
      gap: 2px;
      color: #fbbf24;
      font-size: 0.9rem;
    }

    .rating-value {
      font-weight: 600;
      color: var(--dark);
      font-size: 0.9rem;
    }

    .reviews-count {
      color: var(--gray-400);
      font-size: 0.85rem;
    }

    /* Share Button */
    .share-wrapper {
      position: relative;
      margin-left: auto;
    }

    .share-btn {
      background: var(--surface);
      border: 2px solid var(--gray-200);
      padding: var(--spacing-2) var(--spacing-4);
      border-radius: var(--radius-full);
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-2);
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--gray-600);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-2d-sm);
    }

    .share-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: var(--primary-soft);
      transform: translate(-1px, -1px);
      box-shadow: var(--shadow-2d);
    }

    .share-menu {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-2d-lg);
      padding: var(--spacing-4);
      width: 280px;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      border: 2px solid var(--gray-200);
    }

    .share-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .share-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing-2);
      margin-bottom: var(--spacing-3);
    }

    .share-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: var(--spacing-2);
      border-radius: var(--radius-md);
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--gray-600);
      cursor: pointer;
      transition: all 0.2s;
    }

    .share-option i {
      font-size: 1.1rem;
    }

    .share-option:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
      transform: translate(-1px, -1px);
      box-shadow: var(--shadow-2d-sm);
    }

    .copy-link {
      display: flex;
      gap: 4px;
      margin-top: var(--spacing-2);
    }

    .copy-link input {
      flex: 1;
      padding: var(--spacing-2);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-md);
      font-size: 0.75rem;
    }

    .copy-btn {
      padding: var(--spacing-2) var(--spacing-3);
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.75rem;
      cursor: pointer;
      box-shadow: var(--shadow-2d-sm);
      transition: all 0.2s;
    }

    .copy-btn:hover {
      background: var(--primary-dark);
      transform: translate(-1px, -1px);
      box-shadow: var(--shadow-2d);
    }

    /* Price Card - Enhanced */
    .price-card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-5);
      margin-bottom: var(--spacing-5);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d);
    }

    .price-header {
      display: flex;
      align-items: baseline;
      gap: var(--spacing-3);
      flex-wrap: wrap;
      margin-bottom: var(--spacing-4);
    }

    .current-price {
      font-size: 2.4rem;
      font-weight: 800;
      color: var(--dark);
      font-family: 'Space Grotesk', sans-serif;
      line-height: 1;
    }

    .original-price {
      font-size: 1.3rem;
      color: var(--gray-400);
      text-decoration: line-through;
    }

    .discount {
      background: var(--primary-dark);
      color: white;
      padding: 4px 10px;
      border-radius: var(--radius-full);
      font-weight: 700;
      font-size: 0.8rem;
      box-shadow: var(--shadow-2d-sm);
    }

    /* Price Options - Green for Prepaid, Orange for COD */
    .price-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-3);
      margin-bottom: var(--spacing-4);
    }

    .price-option {
      padding: var(--spacing-4) var(--spacing-3);
      border-radius: var(--radius-lg);
      text-align: center;
      border: 2px solid;
      transition: all 0.2s;
      box-shadow: var(--shadow-2d-sm);
    }

    .price-option:hover {
      transform: translate(-2px, -2px);
      box-shadow: var(--shadow-2d);
    }

    .price-option.prepaid {
      background: var(--accent-green-light);
      border-color: var(--accent-green);
    }

    .price-option.prepaid .option-price {
      color: var(--accent-green);
    }

    .price-option.cod {
      background: var(--accent-orange-light);
      border-color: var(--accent-orange);
    }

    .price-option.cod .option-price {
      color: var(--accent-orange);
    }

    .option-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gray-600);
      margin-bottom: 4px;
    }

    .option-price {
      font-size: 1.6rem;
      font-weight: 700;
      font-family: 'Space Grotesk', sans-serif;
      line-height: 1.2;
    }

    .option-note {
      font-size: 0.7rem;
      color: var(--gray-500);
      margin-top: 4px;
    }

    .option-save {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--accent-green);
    }

    .stock-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: var(--spacing-2) var(--spacing-4);
      background: var(--gray-100);
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 600;
      border: 1px solid var(--gray-200);
    }

    .stock-badge.in-stock {
      color: var(--accent-green);
    }

    .stock-badge.low-stock {
      color: var(--accent-orange);
    }

    /* Money Back Promise - Enhanced */
    .promise-card {
      background: linear-gradient(135deg, #3A4F41, #2A3A31); /* Forest green */
      color: white;
      padding: var(--spacing-5);
      border-radius: var(--radius-xl);
      margin-bottom: var(--spacing-5);
      display: flex;
      align-items: center;
      gap: var(--spacing-4);
      position: relative;
      overflow: hidden;
      border: 2px solid #5A7A6A;
      box-shadow: var(--shadow-2d);
    }

    .promise-card::after {
      content: 'ðŸ”’';
      position: absolute;
      right: -10px;
      bottom: -10px;
      font-size: 5rem;
      opacity: 0.1;
      transform: rotate(15deg);
    }

    .promise-icon {
      width: 56px;
      height: 56px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: #FFD966;
      border: 2px solid rgba(255,255,255,0.3);
    }

    .promise-content h4 {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .promise-content p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.85rem;
    }

    .promise-highlight {
      color: #FFD966;
      font-weight: 700;
    }

    /* Delivery Card */
    .delivery-card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-5);
      margin-bottom: var(--spacing-5);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d);
    }

    .delivery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-4);
      flex-wrap: wrap;
      gap: var(--spacing-2);
    }

    .delivery-title {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      font-weight: 700;
      color: var(--dark);
    }

    .delivery-title i {
      color: var(--primary);
    }

    .delivery-min {
      background: var(--gray-100);
      padding: 4px 12px;
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--gray-600);
      border: 1px solid var(--gray-200);
    }

    .progress-container {
      margin: var(--spacing-3) 0;
    }

    .progress-bar {
      height: 10px;
      background: var(--gray-200);
      border-radius: var(--radius-full);
      overflow: hidden;
      border: 1px solid var(--gray-300);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      width: 0%;
      transition: width 0.3s ease;
      border-radius: var(--radius-full);
    }

    .delivery-message {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      margin-top: var(--spacing-3);
      font-size: 0.9rem;
      font-weight: 500;
    }

    .delivery-message i {
      color: var(--primary);
    }

    .delivery-message.eligible i {
      color: var(--accent-green);
    }

    .cart-value {
      font-weight: 800;
      color: var(--primary);
      background: var(--primary-light);
      padding: 2px 8px;
      border-radius: var(--radius-full);
    }

    /* Features Grid - Mobile Optimized */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-2);
      margin-bottom: var(--spacing-5);
    }

    .feature-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      padding: var(--spacing-3);
      background: var(--gray-50);
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-200);
      box-shadow: var(--shadow-2d-sm);
    }

    .feature-icon {
      width: 40px;
      height: 40px;
      background: white;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      box-shadow: var(--shadow-2d-sm);
      border: 1px solid var(--gray-200);
    }

    .feature-text h4 {
      font-weight: 700;
      font-size: 0.85rem;
      margin-bottom: 2px;
    }

    .feature-text p {
      font-size: 0.7rem;
      color: var(--gray-600);
    }

    /* Quantity - Mobile Optimized */
    .quantity-wrapper {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-5);
      margin-bottom: var(--spacing-5);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d);
    }

    .quantity-label {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      font-weight: 700;
      margin-bottom: var(--spacing-4);
    }

    .quantity-label i {
      color: var(--primary);
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
    }

    .qty-btn {
      width: 44px;
      height: 44px;
      border: 2px solid var(--gray-200);
      background: white;
      border-radius: var(--radius-md);
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--dark);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-2d-sm);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qty-btn:hover:not(:disabled) {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
      transform: translate(-1px, -1px);
      box-shadow: var(--shadow-2d);
    }

    .qty-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .qty-input {
      width: 70px;
      height: 44px;
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-md);
      text-align: center;
      font-size: 1.1rem;
      font-weight: 700;
      background: white;
    }

    /* Action Buttons - Mobile Optimized */
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-3);
      margin-bottom: var(--spacing-6);
    }

    @media (min-width: 480px) {
      .action-buttons {
        flex-direction: row;
      }
    }

    .btn {
      flex: 1;
      padding: var(--spacing-4);
      border: none;
      border-radius: var(--radius-full);
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-2);
      border: 2px solid transparent;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: var(--shadow-2d);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translate(-2px, -2px);
      box-shadow: var(--shadow-2d-hover);
    }

    .btn-secondary {
      background: white;
      color: var(--dark);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d-sm);
    }

    .btn-secondary:hover {
      border-color: var(--primary);
      background: var(--primary-soft);
      transform: translate(-1px, -1px);
      box-shadow: var(--shadow-2d);
    }

    /* Tabs - Mobile Optimized */
    .tabs {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-5);
      margin-bottom: var(--spacing-6);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d);
    }

    .tab-headers {
      display: flex;
      gap: var(--spacing-4);
      border-bottom: 2px solid var(--gray-200);
      margin-bottom: var(--spacing-5);
      overflow-x: auto;
      padding-bottom: 2px;
      scrollbar-width: thin;
    }

    .tab-header {
      padding: var(--spacing-2) 0;
      cursor: pointer;
      font-weight: 600;
      color: var(--gray-400);
      position: relative;
      transition: color 0.2s;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .tab-header:hover {
      color: var(--primary);
    }

    .tab-header.active {
      color: var(--primary);
    }

    .tab-header.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--primary);
    }

    .tab-content {
      display: none;
      line-height: 1.7;
      color: var(--gray-600);
      font-size: 0.9rem;
    }

    .tab-content.active {
      display: block;
    }

    .specs-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-3);
    }

    @media (min-width: 480px) {
      .specs-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .spec-item {
      padding: var(--spacing-3);
      background: var(--gray-50);
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-200);
    }

    .spec-label {
      font-size: 0.75rem;
      color: var(--gray-400);
      margin-bottom: 2px;
    }

    .spec-value {
      font-weight: 700;
      color: var(--dark);
      font-size: 0.9rem;
    }

    .video-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-3);
    }

    @media (min-width: 480px) {
      .video-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .video-item {
      aspect-ratio: 16/9;
      border-radius: var(--radius-lg);
      overflow: hidden;
      position: relative;
      cursor: pointer;
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d-sm);
    }

    .video-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-item i {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 44px;
      height: 44px;
      background: rgba(0,0,0,0.7);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1rem;
      border: 2px solid white;
    }

    .video-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 2px 8px;
      border-radius: var(--radius-full);
      font-size: 0.7rem;
      border: 1px solid rgba(255,255,255,0.3);
    }

    /* Main Reviews Section (Mobile) */
    .reviews-section {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: var(--spacing-5);
      margin-bottom: var(--spacing-6);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-2d);
    }

    .reviews-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-5);
      flex-wrap: wrap;
      gap: var(--spacing-2);
    }

    .reviews-title {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .reviews-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-4);
    }

    @media (min-width: 640px) {
      .reviews-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .review-card {
      padding: var(--spacing-4);
      background: var(--gray-50);
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-200);
      box-shadow: var(--shadow-2d-sm);
    }

    .reviewer {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      margin-bottom: var(--spacing-3);
    }

    .reviewer-avatar {
      width: 44px;
      height: 44px;
      background: var(--primary-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--primary);
      border: 2px solid white;
      box-shadow: var(--shadow-2d-sm);
    }

    .reviewer-info h5 {
      font-weight: 700;
      font-size: 0.95rem;
    }

    .reviewer-info span {
      font-size: 0.75rem;
      color: var(--gray-400);
    }

    .review-rating {
      color: #fbbf24;
      font-size: 0.8rem;
      margin-bottom: var(--spacing-2);
    }

    .review-text {
      font-size: 0.85rem;
      color: var(--gray-600);
      margin-bottom: var(--spacing-3);
      line-height: 1.5;
    }

    .review-helpful {
      display: flex;
      gap: var(--spacing-4);
      font-size: 0.75rem;
      color: var(--gray-400);
    }

    .review-helpful i {
      margin-right: 4px;
    }

    /* Related Products - Mobile Optimized */
    .related {
      margin-top: var(--spacing-8);
      padding-top: var(--spacing-6);
      border-top: 2px solid var(--gray-200);
    }

    .related-title {
      font-size: 1.5rem;
      font-weight: 700;
      font-family: 'Space Grotesk', sans-serif;
      margin-bottom: var(--spacing-5);
    }

    .related-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-3);
    }

    @media (min-width: 640px) {
      .related-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-4);
      }
    }

    .related-card {
      text-decoration: none;
      color: inherit;
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--spacing-3);
      border: 2px solid var(--gray-200);
      transition: all 0.2s;
      box-shadow: var(--shadow-2d-sm);
    }

    .related-card:hover {
      transform: translate(-2px, -2px);
      box-shadow: var(--shadow-2d);
      border-color: var(--primary);
    }

    .related-image {
      aspect-ratio: 1;
      border-radius: var(--radius-md);
      overflow: hidden;
      margin-bottom: var(--spacing-2);
      background: var(--gray-100);
      border: 1px solid var(--gray-200);
    }

    .related-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .related-category {
      font-size: 0.6rem;
      font-weight: 600;
      color: var(--primary);
      text-transform: uppercase;
      margin-bottom: 2px;
    }

    .related-name {
      font-weight: 700;
      font-size: 0.8rem;
      margin-bottom: 4px;
      line-height: 1.3;
    }

    .related-price {
      font-weight: 800;
      color: var(--dark);
      font-size: 1rem;
      margin-bottom: var(--spacing-2);
    }

    .related-add {
      padding: var(--spacing-2);
      background: var(--gray-100);
      border-radius: var(--radius-full);
      text-align: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--gray-600);
      transition: all 0.2s;
      border: 1px solid var(--gray-200);
      cursor: pointer;
    }

    .related-card:hover .related-add {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 16px;
      right: 16px;
      left: 16px;
      background: white;
      border-radius: var(--radius-full);
      padding: var(--spacing-3) var(--spacing-5);
      box-shadow: var(--shadow-2d-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      border: 2px solid var(--gray-200);
      max-width: 400px;
      margin: 0 auto;
    }

    @media (min-width: 640px) {
      .notification {
        left: auto;
        width: auto;
      }
    }

    .notification i {
      color: var(--accent-green);
      font-size: 1.2rem;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Mobile Optimizations */
    @media (max-width: 480px) {
      .price-header {
        flex-wrap: wrap;
      }
      
      .current-price {
        font-size: 2rem;
      }
      
      .original-price {
        font-size: 1.1rem;
      }
      
      .option-price {
        font-size: 1.3rem;
      }
      
      .feature-item {
        padding: var(--spacing-2);
      }
      
      .feature-text h4 {
        font-size: 0.75rem;
      }
      
      .feature-text p {
        font-size: 0.6rem;
      }
    }
  </style>
</head>
<body>
  <div id="header"></div>

  <main>
    <div class="container">
      <div class="breadcrumb">
        <a href="index.html">Home</a>
        <i class="fa-solid fa-chevron-right"></i>
        <a href="collection.html">Collection</a>
        <i class="fa-solid fa-chevron-right"></i>
        <span id="breadcrumb-product">Loading...</span>
      </div>
    </div>

    <div class="container" id="product-container"></div>
  </main>

  <div id="footer"></div>

  <script>
    // ========== FIREBASE CONFIG ==========
    const firebaseConfig = {
      apiKey: "AIzaSyD16uGnm1vodkbqGoFSdFdJjGFSLpJmflk",
      authDomain: "myessantia.firebaseapp.com",
      projectId: "myessantia",
      storageBucket: "myessantia.firebasestorage.app",
      messagingSenderId: "701726517205",
      appId: "1:701726517205:web:f6ab79efdffeab6dbbbf5c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ========== GLOBAL ==========
    let currentProduct = null;
    let cart = JSON.parse(localStorage.getItem('myessantia_cart')) || [];

    // Generate random values
    function getRandomSold() {
      return Math.floor(Math.random() * (1500 - 300 + 1)) + 300;
    }

    function getRandomViewers() {
      return Math.floor(Math.random() * (30 - 5 + 1)) + 5;
    }

    function generateReviews() {
      const users = [
        { name: 'Priya Sharma', city: 'Mumbai', avatar: 'PS' },
        { name: 'Rahul Verma', city: 'Delhi', avatar: 'RV' },
        { name: 'Ananya Patel', city: 'Bangalore', avatar: 'AP' },
        { name: 'Karthik Iyer', city: 'Chennai', avatar: 'KI' },
        { name: 'Neha Gupta', city: 'Pune', avatar: 'NG' },
        { name: 'Arjun Singh', city: 'Hyderabad', avatar: 'AS' },
        { name: 'Divya Nair', city: 'Kochi', avatar: 'DN' },
        { name: 'Vikram Mehta', city: 'Ahmedabad', avatar: 'VM' }
      ];
      
      const comments = [
        "Absolutely love this! Quality is amazing and delivery was super fast.",
        "Perfect product, exceeded my expectations. Worth every penny!",
        "Great quality and beautiful design. My friends keep asking where I got it.",
        "Exactly as described. The material is premium and it looks even better in person.",
        "Excellent customer service and quick shipping. Very happy with purchase.",
        "The attention to detail is impressive. Definitely buying more from this brand.",
        "Good value for money. The product feels very premium.",
        "Fast delivery and great packaging. Will recommend to others!"
      ];
      
      return users.map((user, i) => ({
        ...user,
        comment: comments[i % comments.length],
        rating: (4 + Math.random() * 0.9).toFixed(1),
        time: Math.floor(Math.random() * 48) + 1,
        helpful: Math.floor(Math.random() * 30) + 10
      }));
    }

    function getProductId() {
      return new URLSearchParams(window.location.search).get('id');
    }

    async function loadProduct() {
      const productId = getProductId();
      if (!productId) return showNotFound();

      try {
        const doc = await db.collection('products').doc(productId).get();
        if (!doc.exists) return showNotFound();

        currentProduct = { id: doc.id, ...doc.data() };
        document.getElementById('breadcrumb-product').textContent = currentProduct.title;
        renderProduct(currentProduct);
        loadRelated(currentProduct);
      } catch (error) {
        console.error(error);
        showNotFound();
      }
    }

    function showNotFound() {
      document.getElementById('product-container').innerHTML = `
        <div style="text-align: center; padding: 60px 20px; background: var(--surface); border-radius: 32px; border: 2px solid var(--gray-200); box-shadow: var(--shadow-2d);">
          <i class="fa-solid fa-box-open" style="font-size: 64px; color: var(--gray-400);"></i>
          <h2 style="font-size: 1.8rem; margin: 20px 0;">Product Not Found</h2>
          <p style="color: var(--gray-600);">The product you're looking for doesn't exist.</p>
          <a href="collection.html" style="display: inline-block; margin-top: 30px; padding: 12px 32px; background: var(--primary); color: white; text-decoration: none; border-radius: 999px; font-weight: 600; border: 2px solid var(--primary-dark); box-shadow: var(--shadow-2d);">Browse Collection</a>
        </div>
      `;
    }

    function renderProduct(product) {
      const images = [];
      if (product.media?.images) images.push(...product.media.images.map(i => i.url));
      if (images.length === 0) images.push(product.primaryImg || 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=600');

      const stock = product.stock || 10;
      const originalPrice = Math.round(product.price * 1.2);
      const discount = Math.round(((originalPrice - product.price) / originalPrice) * 100);
      const prepaidPrice = Math.round(product.price * 0.93); // 7% discount
      const codPrice = Math.round(product.price * 1.03); // 3% extra
      
      const quantity = 1;
      const soldCount = getRandomSold();
      const liveViewers = getRandomViewers();
      const reviews = generateReviews();

      const container = document.getElementById('product-container');
      container.innerHTML = `
        <div class="product-grid">
          <!-- Gallery Section with Reviews for Desktop -->
          <div class="gallery-section">
            <div class="main-image">
              <img src="${images[0]}" alt="${product.title}" id="mainImage">
            </div>
            <div class="thumbnail-grid">
              ${images.map((img, i) => `
                <div class="thumbnail ${i === 0 ? 'active' : ''}" onclick="changeImage('${img}', this)">
                  <img src="${img}" alt="thumb">
                </div>
              `).join('')}
            </div>
            
            <!-- Reviews Section - Only visible on desktop -->
            <div class="gallery-reviews">
              <div class="reviews-mini">
                <div class="reviews-mini-header">
                  <h4>What buyers say</h4>
                  <span>â˜… ${(product.rating || 4.5).toFixed(1)}</span>
                </div>
                ${reviews.slice(0, 3).map(r => `
                  <div class="review-mini-item">
                    <div class="review-mini-avatar">${r.avatar}</div>
                    <div class="review-mini-content">
                      <div class="review-mini-name">${r.name}</div>
                      <div class="review-mini-rating">
                        ${'â˜…'.repeat(Math.floor(r.rating))}${r.rating % 1 ? 'Â½' : ''}
                      </div>
                      <div class="review-mini-text">"${r.comment.substring(0, 60)}..."</div>
                    </div>
                  </div>
                `).join('')}
                <div class="view-all-reviews">View all 128 reviews â†’</div>
              </div>
            </div>
          </div>

          <!-- Product Info -->
          <div class="product-info">
            <!-- Social Strip -->
            <div class="social-strip">
              <span class="sold-badge">
                <i class="fa-solid fa-fire"></i> ${soldCount}+ sold
              </span>
              <span class="live-badge">
                <i class="fa-solid fa-circle"></i> ${liveViewers} viewing
              </span>
            </div>

            <div class="product-category">${product.category || 'ACCESSORIES'}</div>
            <h1 class="product-title">${product.title}</h1>

            <!-- Rating -->
            <div class="rating-row">
              <div class="stars">
                ${getStars(product.rating)}
              </div>
              <span class="rating-value">${(product.rating || 4.5).toFixed(1)}</span>
              <span class="reviews-count">(128 reviews)</span>
              
              <!-- Share -->
              <div class="share-wrapper">
                <button class="share-btn" onclick="toggleShare(event)">
                  <i class="fa-solid fa-share-alt"></i> <span class="share-text">Share</span>
                </button>
                <div class="share-menu" id="shareMenu">
                  <div class="share-grid">
                    <button class="share-option" onclick="share('facebook')"><i class="fa-brands fa-facebook-f"></i>FB</button>
                    <button class="share-option" onclick="share('twitter')"><i class="fa-brands fa-x-twitter"></i>TW</button>
                    <button class="share-option" onclick="share('whatsapp')"><i class="fa-brands fa-whatsapp"></i>WA</button>
                    <button class="share-option" onclick="share('telegram')"><i class="fa-brands fa-telegram"></i>TG</button>
                    <button class="share-option" onclick="share('email')"><i class="fa-regular fa-envelope"></i>Mail</button>
                    <button class="share-option" onclick="share('pinterest')"><i class="fa-brands fa-pinterest"></i>Pin</button>
                  </div>
                  <div class="copy-link">
                    <input type="text" id="shareLink" value="${window.location.href}" readonly>
                    <button class="copy-btn" onclick="copyLink()">Copy</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Price Card with Original Price First -->
            <div class="price-card">
              <div class="price-header">
                <span class="current-price">â‚¹${product.price.toFixed(2)}</span>
                <span class="original-price">â‚¹${originalPrice.toFixed(2)}</span>
                <span class="discount">-${discount}%</span>
              </div>
              
              <div class="price-options">
                <div class="price-option prepaid">
                  <div class="option-label">PREPAID</div>
                  <div class="option-price">â‚¹${prepaidPrice}</div>
                  <div class="option-save">Save â‚¹${product.price - prepaidPrice}</div>
                </div>
                <div class="price-option cod">
                  <div class="option-label">CASH ON DELIVERY</div>
                  <div class="option-price">â‚¹${codPrice}</div>
                  <div class="option-note">+â‚¹${codPrice - product.price} fee</div>
                </div>
              </div>

              <span class="stock-badge ${stock > 10 ? 'in-stock' : 'low-stock'}">
                <i class="fa-solid ${stock > 10 ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                ${stock > 10 ? 'In Stock' : `Only ${stock} left`}
              </span>
            </div>

            <!-- Money Back Promise -->
            <div class="promise-card">
              <div class="promise-icon">
                <i class="fa-solid fa-shield"></i>
              </div>
              <div class="promise-content">
                <h4>Razorpay Money Back Promise</h4>
                <p><span class="promise-highlight">100% refund</span> on non-delivery or defects</p>
              </div>
            </div>

            <!-- Delivery Card -->
            <div class="delivery-card" id="deliveryCard">
              <div class="delivery-header">
                <span class="delivery-title">
                  <i class="fa-solid fa-truck"></i> Free Delivery
                </span>
                <span class="delivery-min">Min. â‚¹1,299</span>
              </div>
              
              <div class="progress-container">
                <div class="progress-bar">
                  <div class="progress-fill" id="deliveryProgress" style="width: ${Math.min(100, (product.price / 1299) * 100)}%"></div>
                </div>
              </div>
              
              <div class="delivery-message" id="deliveryMessage">
                <i class="fa-solid ${product.price >= 1299 ? 'fa-circle-check' : 'fa-circle-info'}"></i>
                <span id="deliveryText">
                  ${product.price >= 1299 
                    ? 'You get FREE delivery!' 
                    : `Add <span class="cart-value">â‚¹${(1299 - product.price).toFixed(2)}</span> more`}
                </span>
              </div>
            </div>

            <!-- Features -->
            <div class="features-grid">
              <div class="feature-item">
                <div class="feature-icon"><i class="fa-solid fa-truck-fast"></i></div>
                <div>
                  <h4>Free Shipping</h4>
                  <p>Above â‚¹1,299</p>
                </div>
              </div>
              <div class="feature-item">
                <div class="feature-icon"><i class="fa-solid fa-rotate-left"></i></div>
                <div>
                  <h4>Easy Returns</h4>
                  <p>48 hours</p>
                </div>
              </div>
            </div>

            <!-- Quantity -->
            <div class="quantity-wrapper">
              <div class="quantity-label">
                <i class="fa-solid fa-cubes"></i> Quantity
              </div>
              <div class="quantity-controls">
                <button class="qty-btn" onclick="updateQuantity(-1)" ${stock === 0 ? 'disabled' : ''}>âˆ’</button>
                <input type="text" class="qty-input" id="productQuantity" value="1" readonly>
                <button class="qty-btn" onclick="updateQuantity(1)" ${stock === 0 ? 'disabled' : ''}>+</button>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button class="btn btn-secondary" onclick="addToCart()" ${stock === 0 ? 'disabled' : ''}>
                <i class="fa-solid fa-cart-plus"></i> Add to Cart
              </button>
              <button class="btn btn-primary" onclick="buyNow()" ${stock === 0 ? 'disabled' : ''}>
                <i class="fa-solid fa-bolt"></i> Buy Now
              </button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
              <div class="tab-headers">
                <div class="tab-header active" onclick="switchTab('desc')">Description</div>
                <div class="tab-header" onclick="switchTab('specs')">Specs</div>
                <div class="tab-header" onclick="switchTab('videos')">Videos</div>
              </div>
              <div class="tab-content active" id="tab-desc">
                <p>${product.description || product.shortDesc || 'Premium quality product from MyEssantia. Crafted with attention to detail and made from the finest materials.'}</p>
              </div>
              <div class="tab-content" id="tab-specs">
                <div class="specs-grid">
                  <div class="spec-item">
                    <div class="spec-label">Material</div>
                    <div class="spec-value">Premium Quality</div>
                  </div>
                  <div class="spec-item">
                    <div class="spec-label">Brand</div>
                    <div class="spec-value">${product.brand || 'MyEssantia'}</div>
                  </div>
                  <div class="spec-item">
                    <div class="spec-label">Origin</div>
                    <div class="spec-value">Made in India</div>
                  </div>
                  <div class="spec-item">
                    <div class="spec-label">Warranty</div>
                    <div class="spec-value">6 Months</div>
                  </div>
                </div>
              </div>
              <div class="tab-content" id="tab-videos">
                <div class="video-grid">
                  <div class="video-item">
                    <img src="https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400" alt="video">
                    <i class="fa-solid fa-play"></i>
                    <span class="video-duration">2:34</span>
                  </div>
                  <div class="video-item">
                    <img src="https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400" alt="video">
                    <i class="fa-solid fa-play"></i>
                    <span class="video-duration">1:47</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Reviews Section - Mobile Only (visible on mobile) -->
            <div class="reviews-section mobile-only">
              <div class="reviews-header">
                <span class="reviews-title">Customer Reviews</span>
                <span>â˜… ${(product.rating || 4.5).toFixed(1)} Â· 128</span>
              </div>
              <div class="reviews-grid">
                ${reviews.slice(0, 4).map(r => `
                  <div class="review-card">
                    <div class="reviewer">
                      <div class="reviewer-avatar">${r.avatar}</div>
                      <div class="reviewer-info">
                        <h5>${r.name}</h5>
                        <span>${r.city} Â· ${r.time}h ago</span>
                      </div>
                    </div>
                    <div class="review-rating">
                      ${'â˜…'.repeat(Math.floor(r.rating))}${r.rating % 1 ? 'Â½' : ''}
                    </div>
                    <div class="review-text">"${r.comment}"</div>
                    <div class="review-helpful">
                      <span><i class="fa-regular fa-thumbs-up"></i> ${r.helpful}</span>
                      <span><i class="fa-regular fa-comment"></i> Reply</span>
                    </div>
                  </div>
                `).join('')}
              </div>
              <div class="view-all-reviews">View all 128 reviews â†’</div>
            </div>
          </div>
        </div>
      `;

      // Hide mobile reviews on desktop via CSS
      const style = document.createElement('style');
      style.innerHTML = `
        @media (min-width: 1024px) {
          .mobile-only {
            display: none;
          }
        }
      `;
      document.head.appendChild(style);

      updateDeliveryBar(product.price);
    }

    async function loadRelated(product) {
      try {
        const snap = await db.collection('products')
          .where('category', '==', product.category)
          .limit(5)
          .get();
        
        const related = snap.docs
          .map(d => ({ id: d.id, ...d.data() }))
          .filter(p => p.id !== product.id)
          .slice(0, 4);

        if (related.length === 0) return;

        const html = `
          <div class="related">
            <h2 class="related-title">You may also like</h2>
            <div class="related-grid">
              ${related.map(p => {
                const img = p.media?.images?.[0]?.url || p.primaryImg || 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=200';
                return `
                  <a href="product.html?id=${p.id}" class="related-card">
                    <div class="related-image">
                      <img src="${img}" alt="${p.title}">
                    </div>
                    <div class="related-category">${p.category}</div>
                    <div class="related-name">${p.title.substring(0, 25)}</div>
                    <div class="related-price">â‚¹${p.price.toFixed(2)}</div>
                    <div class="related-add" onclick="event.stopPropagation(); quickAdd('${p.id}')">
                      <i class="fa-solid fa-cart-plus"></i> Add
                    </div>
                  </a>
                `;
              }).join('')}
            </div>
          </div>
        `;
        
        document.getElementById('product-container').insertAdjacentHTML('beforeend', html);
      } catch (e) {
        console.error('Related error:', e);
      }
    }

    // Helper Functions
    function getStars(rating) {
      const r = parseFloat(rating) || 4.5;
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        if (r >= i) stars += '<i class="fa-solid fa-star"></i>';
        else if (r > i-1 && r < i) stars += '<i class="fa-solid fa-star-half-alt"></i>';
        else stars += '<i class="fa-regular fa-star"></i>';
      }
      return stars;
    }

    window.changeImage = function(src, el) {
      document.getElementById('mainImage').src = src;
      document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
    };

    window.updateQuantity = function(delta) {
      const input = document.getElementById('productQuantity');
      let val = parseInt(input.value) || 1;
      val += delta;
      if (val < 1) val = 1;
      if (currentProduct && val > currentProduct.stock) val = currentProduct.stock;
      input.value = val;
      
      if (currentProduct) {
        const total = currentProduct.price * val;
        updateDeliveryBar(total);
      }
    };

    function updateDeliveryBar(total) {
      const progress = document.getElementById('deliveryProgress');
      const message = document.getElementById('deliveryMessage');
      const text = document.getElementById('deliveryText');
      if (!progress || !message || !text) return;

      const percent = Math.min(100, (total / 1299) * 100);
      progress.style.width = percent + '%';

      if (total >= 1299) {
        message.className = 'delivery-message eligible';
        message.querySelector('i').className = 'fa-solid fa-circle-check';
        text.innerHTML = 'You get FREE delivery!';
      } else {
        message.className = 'delivery-message';
        message.querySelector('i').className = 'fa-solid fa-circle-info';
        text.innerHTML = `Add <span class="cart-value">â‚¹${(1299 - total).toFixed(2)}</span> more`;
      }
    }

    // Share Functions
    window.toggleShare = function(e) {
      e.stopPropagation();
      const menu = document.getElementById('shareMenu');
      menu.classList.toggle('show');
      if (menu.classList.contains('show')) {
        setTimeout(() => document.addEventListener('click', closeShare), 100);
      }
    };

    function closeShare(e) {
      const menu = document.getElementById('shareMenu');
      const btn = document.querySelector('.share-btn');
      if (menu && !menu.contains(e.target) && !btn.contains(e.target)) {
        menu.classList.remove('show');
        document.removeEventListener('click', closeShare);
      }
    }

    window.share = function(platform) {
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(currentProduct?.title || 'Product');
      let link = '';
      if (platform === 'facebook') link = `https://facebook.com/sharer/sharer.php?u=${url}`;
      if (platform === 'twitter') link = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
      if (platform === 'whatsapp') link = `https://wa.me/?text=${title}%20${url}`;
      if (platform === 'telegram') link = `https://t.me/share/url?url=${url}&text=${title}`;
      if (platform === 'email') link = `mailto:?subject=${title}&body=${url}`;
      if (platform === 'pinterest') link = `https://pinterest.com/pin/create/button/?url=${url}&description=${title}`;
      if (link) window.open(link, '_blank', 'width=600,height=400');
      document.getElementById('shareMenu')?.classList.remove('show');
    };

    window.copyLink = function() {
      const input = document.getElementById('shareLink');
      input.select();
      navigator.clipboard.writeText(input.value).then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = 'Copied!';
        setTimeout(() => {
          btn.textContent = 'Copy';
        }, 2000);
      });
    };

    // Cart Functions
    window.addToCart = function() {
      showNotification('Product added to cart!');
      
      const btn = event?.target?.closest('button');
      if (btn && btn.classList.contains('btn-secondary')) {
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-check"></i> Added!';
        btn.style.background = 'var(--accent-green)';
        btn.style.color = 'white';
        btn.style.borderColor = 'var(--accent-green)';
        setTimeout(() => {
          btn.innerHTML = original;
          btn.style.background = '';
          btn.style.color = '';
          btn.style.borderColor = '';
        }, 1500);
      }
    };

    window.buyNow = function() {
      addToCart();
      setTimeout(() => {
        window.location.href = 'checkout.html';
      }, 800);
    };

    window.quickAdd = function(id) {
      showNotification('Quick add - coming soon!');
    };

    function showNotification(msg) {
      const existing = document.querySelector('.notification');
      if (existing) existing.remove();

      const notif = document.createElement('div');
      notif.className = 'notification';
      notif.innerHTML = `<i class="fa-solid fa-check-circle"></i> ${msg}`;
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 3000);
    }

    // Tabs
    window.switchTab = function(tab) {
      document.querySelectorAll('.tab-header').forEach(h => h.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`.tab-header[onclick="switchTab('${tab}')"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', loadProduct);
  </script>
</body>
</html>
